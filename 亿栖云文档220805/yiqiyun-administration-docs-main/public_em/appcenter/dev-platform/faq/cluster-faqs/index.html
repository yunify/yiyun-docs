<!doctype html>
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="generator" content="Hugo 0.101.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="icon" href="http://yiqiyun.sd.cegn.cn/static/assets/images/favicon.ico?v=1632342842" type="image/x-icon">

<title>云应用常见问题 | 亿栖云文档</title>

<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/autocomplete.css" rel="stylesheet" />
<link href="/css/copy-to-clipboard.css" rel="stylesheet" />


    



<link rel="preload" href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" as="style">
<link href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" rel="stylesheet" integrity="">


<script
  src="/js/jquery-2.2.4.js?v=1510299508"
  ></script>
	

<script src="/js/common.js?v=1.3"></script>

  </head>
  <body class="td-page">
    <header>
      <div class="nav-wrapper ">
  <nav class="navbar navmenu"  style="display:none;" >
    <div class="container with-no-position doc-container-width ">
      <div class="navbar-brand" id="search-mobile-logo">
        <a class="navbar-item logo" href="http://www.yiqiyun.net.cn">
          <img src="/images/yiqiyun_logo.png" alt="logo" style="height: 32px;width: 120px;">
        </a>
      </div>
      <div class="media-content column is-centered is-5 search-mobile">
        <form action="/search" method="GET">
          <div class="control has-icons-right docs-search-input">
            <input class="input" id="search-bar" name="q" type="search" placeholder="搜索" autocomplete="off">
            <span class="icon is-right" id="mobile-search">
              <img src="/images/icons/search.svg">
            </span>
          </div>
        </form>
        <a href="javascript:;" class="search-mobile-icon"><img src="/images/icons/search.svg"></a>
      </div>
      <div class="navbar-end is-hidden-mobile header-account">
        <div class="navbar-item">
          <div class="field is-grouped">
            <p class="control navbar-user">
              <a class="nav-item" href="http://www.yiqiyun.cn">服务商门户</a>
            </p>
            <p class="control navbar-user">
              <a class="nav-item" href="http://console.yiqiyun.cn/login">登录</a>
            </p>
            <div class="navbar-user">
              <a class="button is-primary j-signup" href="http://console.yiqiyun.cn/signup/" data-gio="{id:'createPageView',var:{sourceType_var:'导航栏'}}" style="background-color: #55a8fd">注册</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  
  <nav class="navbar navmenu navbar-index">
    <div class="container is-size-7 doc-container-width " data-path="1">


	
	
		

  
  

  
  

  
  

  


	
	




  


	
	
	<a href="/appcenter/dev-platform/" class="has-text-primary">应用开发平台</a><img class="container_span_space" src="/images/icons/path.svg">
	




  


	
	
	<a href="" class="has-text-primary">常见问题</a><img class="container_span_space" src="/images/icons/path.svg">
	




  



	
	<span class="crumb-last-color">详情</span>
	



	

</div>


  </nav>
  
</div>
    </header>
    <div class="container td-outer doc-container-width container-min-height">
      <div class="td-main">
		
			<h1 class="console-tree-title">常见问题</h1>
		
        <div class="row flex-xl-nowrap">
		  
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none td-sidebar-menu">
            





<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2" id="td-section-nav">
    <div class="nav-item dropdown d-block ">
      
      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  应用市场
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/market/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/market/intro/10_introduction/"
      class="menu__title  "
      data-depth="1">AppCenter 应用市场</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  服务商入驻
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/serviceprovider/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/market/serviceprovider/10_prerequisite/"
      class="menu__title  "
      data-depth="1">入驻须知</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/market/serviceprovider/20_contracts/"
      class="menu__title  "
      data-depth="1">入驻流程</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/manual/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/market/manual/10_cloud_app/"
      class="menu__title  "
      data-depth="1">云应用</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/market/manual/20_saas_app/"
      class="menu__title  "
      data-depth="1">SaaS 应用</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/market/manual/30_license_app/"
      class="menu__title  "
      data-depth="1">License 应用</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse active display-hide"
  data-depth="0">
  应用开发平台
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/dev-platform/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/introduction/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/introduction/introduction/"
      class="menu__title  "
      data-depth="1">简介</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/introduction/architechure/"
      class="menu__title  "
      data-depth="1">系统架构</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quick-start/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/quick-start/cluster/"
      class="menu__title  "
      data-depth="1">云应用入门指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/quick-start/quick_start_saas/"
      class="menu__title  "
      data-depth="1">集成（SaaS）应用</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  云应用开发指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/cluster-developer-guide/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/app/management/"
      class="menu__title  "
      data-depth="1">应用管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/app-version/management/"
      class="menu__title  "
      data-depth="1">应用版本管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/image-build/build/"
      class="menu__title  "
      data-depth="1">镜像制作</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/metadata/metadata-service/"
      class="menu__title  "
      data-depth="1">Metadata 服务</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/basic-specifications/"
      class="menu__title  "
      data-depth="1">开发模板规范 - 基础版</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications/"
      class="menu__title  "
      data-depth="1">开发模板规范 - 完整版</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/lifecycle/"
      class="menu__title  "
      data-depth="1">实例生命周期</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/user/management/"
      class="menu__title  "
      data-depth="1">用户管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/instance/management/"
      class="menu__title  "
      data-depth="1">实例管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/log/log/"
      class="menu__title  "
      data-depth="1">日志管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/cluster-developer-guide/debug/debug/"
      class="menu__title  "
      data-depth="1">调试管理</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  SaaS 应用开发指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/saas-developer-guide/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/saas-developer-guide/saas-flow/"
      class="menu__title  "
      data-depth="1">接入流程</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/saas-developer-guide/account/"
      class="menu__title  "
      data-depth="1">平台账户对接</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/saas-developer-guide/event-notice/"
      class="menu__title  "
      data-depth="1">计费事件通知</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/saas-developer-guide/release/"
      class="menu__title  "
      data-depth="1">应用上架</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  License 应用上架指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/license-guide/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/license-guide/release/"
      class="menu__title  "
      data-depth="1">应用上架</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  平台管理
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/platform-manage/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/platform-manage/finance/finance/"
      class="menu__title  "
      data-depth="1">财务管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/platform-manage/order/order/"
      class="menu__title  "
      data-depth="1">订单管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/platform-manage/tickets/tickets/"
      class="menu__title  "
      data-depth="1">工单管理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/platform-manage/notification/notification/"
      class="menu__title  "
      data-depth="1">通知中心</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/faq/ data-link=/appcenter/dev-platform/faq/cluster-faqs/>
  
  
  
  
  
  <li>
    <a href="/appcenter/dev-platform/faq/cluster-faqs/"
      class="menu__title active "
      data-depth="1">云应用常见问题</a>
  </li>
  
  
</ul>


  
  
</ul>


      
    </div>
  </nav>
</div>


<script src="/js/sidebar-tree.js"></script>


          </div>
          <div class="d-none col-md-2 d-xl-block d-md-block col-xl-2 td-toc d-print-none">
            


<h3 class="nav-title">本页目录</h3>


<nav id="TableOfContents">
  <ul>
    <li><a href="#问题列表">问题列表</a>
      <ul>
        <li><a href="#1-作为新手如何从一个最简单的例子入手">1. 作为新手，如何从一个最简单的例子入手？</a></li>
        <li><a href="#2-app-agent-是什么如何安装-app-agent-程序">2. app agent 是什么？如何安装 app agent 程序？</a></li>
        <li><a href="#3-如何创建-toml-和-tmpl-的模板文件">3. 如何创建 toml 和 tmpl 的模板文件？</a></li>
        <li><a href="#4-什么是-metadata-服务如何查询-metadata-上的值">4. 什么是 Metadata 服务，如何查询 Metadata 上的值？</a></li>
        <li><a href="#5-如何查看日志">5. 如何查看日志？</a></li>
        <li><a href="#6-如何理解数据持久化和挂盘该如何配置如何检查数据持久化是否配置成功">6. 如何理解数据持久化和挂盘，该如何配置？如何检查数据持久化是否配置成功？</a></li>
        <li><a href="#7-如何写健康检查的配置和脚本">7. 如何写健康检查的配置和脚本？</a></li>
        <li><a href="#8-如何写监控数据的配置和脚本">8. 如何写监控数据的配置和脚本？</a></li>
        <li><a href="#9-如何写自定义服务的脚本">9. 如何写自定义服务的脚本？</a></li>
        <li><a href="#10-如何设置应用自身的配置参数">10. 如何设置应用自身的配置参数？</a></li>
        <li><a href="#11-用户输入参数如何做校验如何支持正则表达式">11. 用户输入参数如何做校验,如何支持正则表达式？</a></li>
        <li><a href="#12-如何展示节点的其他信息">12. 如何展示节点的其他信息？</a></li>
        <li><a href="#13-如何开放vnc给用户允许用户访问节点">13. 如何开放VNC给用户，允许用户访问节点？</a></li>
        <li><a href="#14-如何备份">14. 如何备份？</a></li>
        <li><a href="#15-如何升级如何支持应用的大版本升级">15. 如何升级，如何支持应用的大版本升级？</a></li>
        <li><a href="#16-如何设置集群的-vip">16. 如何设置集群的 VIP？</a></li>
        <li><a href="#17-如何支持用户下载和查看应用的日志">17. 如何支持用户下载和查看应用的日志？</a></li>
        <li><a href="#18-如何语言国际化">18. 如何语言国际化？</a></li>
        <li><a href="#19-应用实例调用的脚本中环境变量在创建应用实例后变得不可用的问题">19. 应用实例调用的脚本中环境变量在创建应用实例后变得不可用的问题？</a></li>
        <li><a href="#20-如何配置依赖其他集群的服务">20. 如何配置依赖其他集群的服务？</a></li>
        <li><a href="#21-执行操作失败时如何展示给用户错误提示">21. 执行操作失败时如何展示给用户错误提示？</a></li>
        <li><a href="#22-如何配置横向扩容">22. 如何配置横向扩容？</a></li>
        <li><a href="#23-如何支持集群切换私网网络">23. 如何支持集群切换私网网络？</a></li>
        <li><a href="#24-如何将角色的某个节点直接绑定公网-ip">24. 如何将角色的某个节点直接绑定公网 IP？</a></li>
        <li><a href="#25-如何获取依赖其他集群的服务的-appid-和-appversionid">25. 如何获取依赖其他集群的服务的 AppID 和 AppVersionID？</a></li>
        <li><a href="#26-能否提供一些-confd-templates即-tmpl-文件的使用例子">26. 能否提供一些 confd templates（即 tmpl 文件）的使用例子？</a></li>
        <li><a href="#27-confd-日志显示-key-找不到的错误信息">27. confd 日志显示 key 找不到的错误信息</a></li>
        <li><a href="#28-上传配置包时报错配置验证失败报configjson-not-valid-json错误">28. 上传配置包时报错：配置验证失败,报[config.json] Not valid json错误？</a></li>
        <li><a href="#29-我在测试的时候发现设置的服务价格没起作用原因是什么">29. 我在测试的时候发现设置的服务价格没起作用，原因是什么？</a></li>
        <li><a href="#30-节点的启动停止命令执行出错请确保命令写完整的全路径">30. 节点的启动/停止命令执行出错，请确保命令写完整的全路径。</a></li>
        <li><a href="#31-使用-kvm-作为镜像模板时应用创建资源失败登录创建的节点发现文件系统变成只读该如何排查">31. 使用 kvm 作为镜像模板时，应用创建资源失败，登录创建的节点发现文件系统变成只读，该如何排查？</a></li>
        <li><a href="#32-使用说明和服务条款的-markdown-语法说明">32. 使用说明和服务条款的 Markdown 语法说明</a></li>
        <li><a href="#33-如果只想用云应用开发框架管理纯云服务器集群">33. 如果只想用云应用开发框架管理纯云服务器集群</a></li>
        <li><a href="#34-如何使用环境变量里的-accesskey-类型数据">34. 如何使用环境变量里的 accesskey 类型数据？</a></li>
        <li><a href="#35-环境变量里如何支持层级联动关系">35. 环境变量里如何支持层级联动关系？</a></li>
        <li><a href="#36-如何定义原地升级方式">36. 如何定义原地升级方式？</a></li>
        <li><a href="#37-升级操作时如何给用户弹出提示">37. 升级操作时如何给用户弹出提示？</a></li>
        <li><a href="#38-串行纵向扩容或滚动升级时如何按照一定顺序进行操作">38. 串行纵向扩容或滚动升级时，如何按照一定顺序进行操作？</a></li>
      </ul>
    </li>
  </ul>
</nav>




          </div>
          <main class="col-12 col-md-7 col-xl-7" role="main">
            
  

            
            
            
<div class="td-content">
	<div class="td-sidebar-section-title content-index">
		<img class="is-40x40" src="/images/icons/book-open.svg">
		<h3 class="doc_vice_title">常见问题</h3>
		<a href="javascript:;" class="nav-trigger">&nbsp;<span aria-hidden="true"></span></a>
	</div>
	<div class="td-page-top">
		<h1>云应用常见问题</h1>
		






<div class="td-page-meta page-meta-actions ml-2 pb-1 mb-0">







</div>



	</div>
	<div class="page-meta-lastmod text-muted ">
	更新时间 2020-11-11

</div>

	<input type="hidden" id="content_console" value="1">
	
	
	
	

	
	<h2 id="问题列表">问题列表</h2>
<h3 id="1-作为新手如何从一个最简单的例子入手">1. 作为新手，如何从一个最简单的例子入手？</h3>
<p>作为新手我们建议从 <strong>大数据服务ZooKeeper</strong> 或者 <strong>云数据库云数据库Redis Cluster</strong> 入手。</p>
<h3 id="2-app-agent-是什么如何安装-app-agent-程序">2. app agent 是什么？如何安装 app agent 程序？</h3>
<p>下载亿栖云提供的 app agent <a href="/appcenter/dev-platform/cluster-developer-guide/scripts/app-agent-linux-amd64.tar.gz">Linux 版本</a>,
<a href="/appcenter/dev-platform/cluster-developer-guide/scripts/app-agent-windows-386.zip">Windows 版本</a>，
解压后运行 ./install.sh (Windows 下双击 install.bat)。</p>
<p>此 agent 中包含了自动配置文件程序 confd，该程序是在开源 confd 的基础上修改了一些 bug 并且增加了一些算术功能，
详情见 <a href="https://github.com/yunify/confd/">confd</a>。</p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/image-build/build/#%E5%88%B6%E4%BD%9C-kvm-%E9%95%9C%E5%83%8F">制作 KVM 镜像</a></p>
</blockquote>
<h3 id="3-如何创建-toml-和-tmpl-的模板文件">3. 如何创建 toml 和 tmpl 的模板文件？</h3>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/image-build/build/#%E5%88%B6%E4%BD%9C-kvm-%E9%95%9C%E5%83%8F">制作 KVM 镜像</a></p>
<p><strong>关键字</strong>： 创建模板文件</p>
<h3 id="4-什么是-metadata-服务如何查询-metadata-上的值">4. 什么是 Metadata 服务，如何查询 Metadata 上的值？</h3>
<p>亿栖云 AppCenter 的 metadata service 是在存储服务etcd 基础之上进行了二次开发，主要增加了 self 属性，
即每个节点只能从该服务获取到自身相关的信息，如本机 IP、server ID 等， 此项目已在 github 上开源。<br>
在创建好一个集群后，登陆到任意一个节点，在文件 /etc/confd/confd.toml 里找到 nodes 这一行(这个文件是亿栖云调度系统在用户创建集群的时候自动生成的)，
这一行定义的是 metadata server 的 IP 地址，任取一个 IP，运行下面命令即可看到所有信息。</p>
<blockquote>
<p>注明：同一 VPC 里所有集群这个文件内容相同。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://<span style="color:#f92672">[</span>IP<span style="color:#f92672">]</span>/self
</span></span></code></pre></div><p>或者直接访问</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://metadata/self
</span></span></code></pre></div><blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/metadata/metadata-service">Metadata 服务</a></p>
</blockquote>
<h3 id="5-如何查看日志">5. 如何查看日志？</h3>
<p>App有以下几种日志信息需要开发者关注。</p>
<ol>
<li>
<p>集群云服务器里的 confd的日志  <br>
启动时的 log： /opt/yiqiyun/app-agent/log/confd-onetime.log<br>
其他操作修改时的 log： /opt/yiqiyun/app-agent/log/confd.log</p>
<blockquote>
<p>其他操作是指修改了 confd 相关的 .toml 和 .tmpl 文件后,执行了 service confd restart 命令之后重新生成新的 confd 相关的日志。</p>
</blockquote>
</li>
<li>
<p>应用本身服务调用的日志  <br>
应用本身服务的初始化、启动、停止等指令，AppCenter 调度系统会发送这些命令到指定节点执行，非必填项。<br>
在 <a href="http://appcenter.yiqiyun.net.cn/developer/">AppCenter 云应用开发平台</a> 上可以查到相关日志。
<img src="/appcenter/dev-platform/cluster-images/faq_applog.png" alt="faq_applog.png"></p>
</li>
<li>
<p>监控日志
监控日志主要是指用户开发的健康检查和监控命令调用的日志。<br>
在 <a href="http://appcenter.yiqiyun.net.cn/developer/">AppCenter 云应用开发平台</a> 上可以查到相关日志。<br>
<img src="/appcenter/dev-platform/cluster-images/faq_appmonitorlog.png" alt="faq_applog.png"></p>
</li>
</ol>
<h3 id="6-如何理解数据持久化和挂盘该如何配置如何检查数据持久化是否配置成功">6. 如何理解数据持久化和挂盘，该如何配置？如何检查数据持久化是否配置成功？</h3>
<p>所谓持久化数据是指跟具体用户有关的数据，如 session、用户自己的数据如用户的数据库信息、用户设置的参数、日志等。
而应用程序，比如数据库应用程序本身不是持久化数据，因为它可以无差别的重复部署而不影响服务。</p>
<p>基于AppCenter开发的应用实例如果不配置挂载盘是不会保存用户需要持久化的数据的，在实例重启之后数据都会清空。
因此需要在config文件中配置挂盘，配置挂载盘之后，每次实例重新启动后会从该挂载盘的路径下读取用户持久化的数据。<br>
具体参数配置如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;nodes&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;tomcat_nodes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;container&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;kvm&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;zone&#34;</span>: <span style="color:#e6db74">&#34;jn1a&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;img-h73eih5e&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;loadbalancer&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.loadbalancer</span>}},
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;instance_class&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.instance_class</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;count&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.count</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;cpu&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.cpu</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;memory&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.memory</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;volume&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;size&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.volume_size</span>}},
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mount_point&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;/data&#34;</span>,  <span style="color:#960050;background-color:#1e0010">***请注意这里!!!</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mount_options&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;defaults,noatime&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;filesystem&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;ext4&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>通常如果配置了数据持久化处理，在配置文件的init脚本中需要编写脚本，将应用的默认的数据路径下的数据复制到挂载盘下。
init脚本在创建集群的时候调用，并且只在创建集群的时候调用一次。</p>
<pre tabindex="0"><code class="language-mustache" data-lang="mustache"># cluster.json.mustache 文件

&#34;services&#34;: {
    &#34;init&#34;: {
        &#34;cmd&#34;: &#34;systemctl restart rsyslog;mkdir -p /data/webapps;rsync -aqxP /opt/apache-tomcat-7.0.78/webapps/ /data/webapps&#34;
    },    ***请注意这里!!!
}
</code></pre><p>如何检查数据持久化是否配置成功？<br>
关闭集群，再启动集群，打开应用实例查看数据是否还在。</p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a> 关键字：init</p>
</blockquote>
<h3 id="7-如何写健康检查的配置和脚本">7. 如何写健康检查的配置和脚本？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;health_check&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;enable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;interval_sec&#34;</span>: <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;timeout_sec&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action_timeout_sec&#34;</span>: <span style="color:#ae81ff">30</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;healthy_threshold&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;unhealthy_threshold&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;check_cmd&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/bin/check.sh&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action_cmd&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/bin/action.sh&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果配置了此参数，在控制台上会展示各个节点的服务状态是否健康。
<img src="/appcenter/dev-platform/cluster-images/faq_healthcheck.png" alt="faq_healthcheck.png"></p>
<blockquote>
<p>check_cmd 的内容为根据你的应用自己编写的脚本，appcenter 会根据 exit code 判断是否健康，
exit code 为 0 则健康，非 0 则不健康。action_cmd 的内容为在服务不健康的情况下需要做的动作。</p>
</blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
<p><strong>关键字</strong>：health_check</p>
<h3 id="8-如何写监控数据的配置和脚本">8. 如何写监控数据的配置和脚本？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;monitor&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;enable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pgmonitor.py&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;connCnt&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;unit&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;value_type&#34;</span>: <span style="color:#e6db74">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;statistics_type&#34;</span>: <span style="color:#e6db74">&#34;latest&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;scale_factor_when_display&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;commitCnt&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;unit&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;value_type&#34;</span>: <span style="color:#e6db74">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;statistics_type&#34;</span>: <span style="color:#e6db74">&#34;latest&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;scale_factor_when_display&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;groups&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;connCntGrp&#34;</span>: [<span style="color:#e6db74">&#34;connCnt&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;commitCntGrp&#34;</span>: [<span style="color:#e6db74">&#34;commitCnt&#34;</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;display&#34;</span>: [<span style="color:#e6db74">&#34;connCntGrp&#34;</span>,<span style="color:#e6db74">&#34;commitCntGrp&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;alarm&#34;</span>: [<span style="color:#e6db74">&#34;connCnt&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果配置了此参数，在控制台上会展示各个节点的具体监控数据的值。
<img src="/appcenter/dev-platform/cluster-images/faq_monitor.png" alt="faq_monitor.png"></p>
<blockquote>
<p>cmd的内容为根据你的应用自己编写的脚本，其返回结果是特定格式的json。</p>
</blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
<p><strong>关键字</strong>：monitor</p>
<h3 id="9-如何写自定义服务的脚本">9. 如何写自定义服务的脚本？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;services&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;init&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pginit.sh&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;start&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pgstart.sh&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;restart&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pgrestart.sh&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;RebuildStandby&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;custom&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pgrebuildstandby.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">86400</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span></code></pre></div><p>如果配置了此参数，在控制台上会展示各个节点的具体监控数据的值。<br>
<img src="/appcenter/dev-platform/cluster-images/faq_customservice.png" alt="faq_customservice.png"></p>
<blockquote>
<p>cmd 的内容为根据你的应用自己编写的脚本，自定义服务的内容。</p>
</blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
<p><strong>关键字</strong>：&ldquo;type&rdquo;: &ldquo;custom&rdquo;</p>
<h3 id="10-如何设置应用自身的配置参数">10. 如何设置应用自身的配置参数？</h3>
<p>首先在 config.json 文件中定义定义用户在创建应用的时候需填入的参数信息，参数包括资源信息如 CPU、内存、节点数等，
还包括应用本身配置参数以及外面依赖集群信息等。 这些信息有集群级别的全局设置，也有基于角色节点级别的信息设置。<br>
其次，定义好参数信息，在c luster.json.mustache 文件中可以引用这些变量。</p>
<p>示例（应用全局级别）如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">config.json</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;env&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;application configuration properties&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;properties&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;DBname&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;DBname&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;DB name to create&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;qiyiyun&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;changeable&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;max_connections&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;max_connections&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Sets the maximum number of concurrent connections.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#ae81ff">256</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;min&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;max&#34;</span>: <span style="color:#ae81ff">65536</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;env&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;DBname&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{env.DBname</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;max_connections&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{env.max_connections</span>}<span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>    
</span></span></code></pre></div><p>同时定义好应用的配置参数，在 confd 的 .tmpl 文件中可以使用这些参数。例如:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>max_connections= {{getv &#34;/env/max_connections&#34;}}
</span></span></code></pre></div><p>也可以使用 shell 脚本在 metadata server 上获取改值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://metadata/self/cluster/endpoints/reserved_ips/vip/value
</span></span></code></pre></div><p>如果配置了此参数，在控制台集群列表的<code>配置参数</code>tab页可以查看具体配置信息。
<img src="/appcenter/dev-platform/cluster-images/faq_params.png" alt="faq_params.png"></p>
<blockquote>
<p>角色节点级别的示例和具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：env</p>
<h3 id="11-用户输入参数如何做校验如何支持正则表达式">11. 用户输入参数如何做校验,如何支持正则表达式？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">config.json</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;env&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Tomcat cluster service properties&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;properties&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;tomcat_user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;User name to access Tomcat manager GUI&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;User name to access Tomcat manager GUI, avoid to set it as &#39;tomcat&#39; because it&#39;s already predefined with role &#39;manager_script&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;qingAdmin&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(？!.*？[tT][oO][mM][cC][aA][tT]).*$&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果配置了此参数，输入非法数据，在提交创建应用的时候会提示错误信息。
<img src="/appcenter/dev-platform/cluster-images/faq_pattern.png" alt="faq_pattern.png"></p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：pattern</p>
<h3 id="12-如何展示节点的其他信息">12. 如何展示节点的其他信息？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;display_tabs&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;node_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pgnodedetails.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><p>如果配置了此参数，在控制台集群列表会多出一个tab页可以查看具体配置信息。
<img src="/appcenter/dev-platform/cluster-images/faq_nodedetails.png" alt="faq_nodedetails.png">
cmd内容为采集的数据需执行的命令，必填项。<br>
采集的数据以 JSON Object 的方式输出，例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;labels&#34;</span>: [<span style="color:#e6db74">&#34;节点ID&#34;</span>,<span style="color:#e6db74">&#34;节点IP&#34;</span>, <span style="color:#e6db74">&#34;角色&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;data&#34;</span>: [
</span></span><span style="display:flex;"><span>        [<span style="color:#e6db74">&#34;cln-ydozfe18&#34;</span>,<span style="color:#e6db74">&#34;192.168.100.2&#34;</span>, <span style="color:#e6db74">&#34;Master&#34;</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#e6db74">&#34;cln-fq788j27&#34;</span>,<span style="color:#e6db74">&#34;192.168.100.6&#34;</span>, <span style="color:#e6db74">&#34;Standby&#34;</span>]
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>返回结果会以表格的形式展示在集群详情页自定义标题的tab页下，其中 &ldquo;labels&rdquo; 和 &ldquo;data&rdquo; 是固定key。 <br>
labels 表示表格第一行的标题，是个 list，最多可定义5列； <br>
data标示表格里面每行数据，要求data是个list，list下是多个子list，最多255个。
其中每个子list标示一行数据，元素个数需和labels中一致。</p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：display_tabs</p>
<h3 id="13-如何开放vnc给用户允许用户访问节点">13. 如何开放VNC给用户，允许用户访问节点？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;log_node&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;container&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;kvm&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;zone&#34;</span>: <span style="color:#e6db74">&#34;jn1a&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;img-b5urfv9t&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;instance_class&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.log_node.instance_class</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;user_access&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">,</span>     <span style="color:#960050;background-color:#1e0010">***请注意这里!!!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;count&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;cpu&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.log_node.cpu</span>}<span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>如果配置了此参数，在控制台上集群的节点列表下会有一个VNC的小图标，点击该图标可以登录该节点。
<img src="/appcenter/dev-platform/cluster-images/faq_vnc.png" alt="faq_vnc.png"> <br>
同时，在 <a href="http://appcenter.yiqiyun.net.cn/apps/">AppCenter应用开发</a> 搜索找到你需要的应用，打开<code>资源</code> tab 页，右侧有一个 VNC 小图标。 <br>
<img src="/appcenter/dev-platform/cluster-images/faq_vnc2.png" alt="faq_vnc2.png"></p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：user_access</p>
<h3 id="14-如何备份">14. 如何备份？</h3>
<p>backup_policy 定义应用的备份策略，支持 &ldquo;device&rdquo; 和 &ldquo;custom&rdquo; 两种类型。
&ldquo;device&rdquo; 表示对节点的挂盘做 snapshot；&ldquo;custom&rdquo; 则是使用自定义的备份命令进行备份操作，比如备份到某个目录，或拷贝到某个节点。非必填项</p>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.name</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.description</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;vxnet&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.vxnet</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;backup_policy&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;device&#34;</span><span style="color:#960050;background-color:#1e0010">,</span>  <span style="color:#960050;background-color:#1e0010">***请注意这里!!!</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>注意，如果设置了备份策略参数的话，必须将 service 下的 backup 命令写上，否则该参数不会生效。 示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;services&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;init&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pginit.sh&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;backup&#34;</span>: {  <span style="color:#960050;background-color:#1e0010">***请注意这里!!!</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;:Info: Backup by Appcenter interface!&#39;  &gt;&gt;/data/pgsql/main/pg_log/pgscripts.log&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">86400</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;restore&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;echo `date &#39;+%Y-%m-%d %H:%M:%S&#39;`&#39;:Info: Backup by Appcenter interface!&#39;  &gt;&gt;/data/pgsql/main/pg_log/pgscripts.log&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">86400</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果配置了此参数，在控制台上集群右键会出现创建备份的菜单。
<img src="/appcenter/dev-platform/cluster-images/faq_backup.png" alt="faq_backup.png">
以上示例是基于device类型的备份策略，对于custom类型类似，但是需要注意如下几点：</p>
<ol>
<li>&ldquo;backup_policy&rdquo;: &ldquo;custom&rdquo;,</li>
<li>&ldquo;backup&rdquo;: cmd 参数会默认传入一个 snapshot id 作为参数，在 cmd 脚本可以获取到这个参数。<br>
例如：执行的时候是 <code>sh /opt/yourbackup.sh '{&quot;snapshot_id&quot;: &quot;s-12345678&quot;}</code>&rsquo;  开发者可以解析后在 cmd 命令写成处理成 <code>cp /opt/data.txt /data/s-12345678</code></li>
<li>&ldquo;restore&rdquo;: restore 操作的时候类似。cmd 参数会默认传入一个 snapshot id 作为参数，在 cmd 脚本可以获取到这个参数。<br>
例如：执行的时候是 <code>sh /opt/yourrestore.sh '{&quot;snapshot_id&quot;: &quot;s-12345678&quot;}'</code>  开发者可以解析后在 cmd 命令写成处理成 <code>cp /data/s-12345678 /opt/data.txt</code></li>
</ol>
<blockquote>
<p>注意：restore 操作是在恢复的新集群上进行操作的。</p>
</blockquote>
<p>incremental_backup_supported
定义应用是否支持增量备份。
备份分为全量备份和增量备份，全量备份每次创建新的备份链，而增量备份会在原有备份链上基于上一个备份点创建新的备份点，删除备份链上某一备份点后，
其后的所有备份点都会被相应删除。默认值为 false 表示只支持全量备份，非必填项。</p>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.name</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.description</span>}<span style="color:#960050;background-color:#1e0010">},</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;upgrade_policy&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;appv-djgirq3p&#34;</span>,<span style="color:#e6db74">&#34;appv-gr2vm9ee&#34;</span>,<span style="color:#e6db74">&#34;appv-qmxgxyc1&#34;</span>,<span style="color:#e6db74">&#34;appv-7tb3ldwl&#34;</span>,<span style="color:#e6db74">&#34;appv-6vsdo968&#34;</span>,<span style="color:#e6db74">&#34;appv-ng9ai35b&#34;</span>,<span style="color:#e6db74">&#34;appv-f3stol95&#34;</span>]<span style="color:#960050;background-color:#1e0010">,</span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;vxnet&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.vxnet</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;backup_policy&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;device&#34;</span><span style="color:#960050;background-color:#1e0010">,</span>   	
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;incremental_backup_supported&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">,***请注意这里!!!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;nodes&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;pg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;container&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;lxc&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;img-nkp0orrc&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;zone&#34;</span>: <span style="color:#e6db74">&#34;sh1a&#34;</span>
</span></span><span style="display:flex;"><span>        }<span style="color:#960050;background-color:#1e0010">]</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：backup_policy、backup、incremental_backup_supported</p>
<h3 id="15-如何升级如何支持应用的大版本升级">15. 如何升级，如何支持应用的大版本升级？</h3>
<p>云应用支持的升级的原理是，用新的版本的镜像去驱动挂载盘下应用的数据，因此如果应用本身的版本没有变化或者只是小版本升级，
可以直接通过升级参数配置进行无缝升级。<br>
示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.name</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.description</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;vxnet&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.vxnet</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;upgrade_policy&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;appv-djgirq3p&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>同时，如果在升级的同时要做一些其他的任务，可以在 service 的 upgrade 脚本里编写自己的内容。示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;services&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;init&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/scripts/pginit.sh&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;upgrade&#34;</span>: {    <span style="color:#960050;background-color:#1e0010">***请注意这里!!!</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/sbin/upgrade.sh&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果配置了此参数，在控制台上原来旧的版本的集群列表集群右侧会出现一个向上的升级箭头，关闭旧的集群，点击该图标就可以直接升级到最新的版本。<br>
请注意 upgrade 脚本是在新的应用的集群上运行的。</p>
<p>对于应用的大版本升级的问题，例如 云数据库PostgreSQL9.6 和 云数据库PostgreSQL10，如果直接采用上面的方法是不可用的，
因为对于新版本的应用（云数据库PostgreSQL10）是无法驱动挂载盘下的旧版本（云数据库PostgreSQL9.6）格式的数据，
需要对挂载盘下的数据做转换才可以以升级后的新版本的应用读取数据。 <br>
因此，我们建议有以下2种方式进行升级处理。</p>
<ul>
<li>新版本不直接支持从旧版本无缝升级到新版本，用户创建好新版本后，自己通过工具将数据从旧版本导入到新版本的集群中去。</li>
<li>新版本直接支持从旧版本无缝升级到新版本，在新版本的镜像中同时安装新旧2个版本，在 upgrade 的 cmd 编写脚本，
将数据从旧版本转换成新版本可直接读取的文件格式。</li>
</ul>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：upgrade_policy、upgrade</p>
<h3 id="16-如何设置集群的-vip">16. 如何设置集群的 VIP？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;reserved_ips&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vip&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}		
</span></span></code></pre></div><p>如果配置了此参数，在控制台上集群信息左侧会出现 VIP 的具体信息。<br>
<img src="/appcenter/dev-platform/cluster-images/faq_vip.png" alt="faq_vip.png"></p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：reserved_ips</p>
<h3 id="17-如何支持用户下载和查看应用的日志">17. 如何支持用户下载和查看应用的日志？</h3>
<p>对于这个需求，解决的办法可以有多种方式。</p>
<ol>
<li>应用自身提供的 web 页面的 log 查看方式。</li>
<li>若应用本身不提供 web log，可以开放 ftp 权限给用户去应用的日志路径下查看日志。</li>
<li>采用第三方日志收集工具 rsyslog，logstash 等日志收集到日志节点，允许用户登录该节点查看日志。</li>
<li>其他方式。</li>
</ol>
<h3 id="18-如何语言国际化">18. 如何语言国际化？</h3>
<p>如果您想要适应不同的语言，需要在提交的应用中包含一个 locale 文件夹，并添加对应语言的翻译文件，如：</p>
<ul>
<li>locale/en.json 英文翻译文件</li>
<li>locale/zh-cn.json 中文翻译文件</li>
</ul>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">locale/zh-cn.json</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Master&#34;</span>: <span style="color:#e6db74">&#34;主节点&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Slave&#34;</span>: <span style="color:#e6db74">&#34;从节点&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;CPU&#34;</span>: <span style="color:#e6db74">&#34;CPU&#34;</span>
</span></span><span style="display:flex;"><span>}			
</span></span></code></pre></div><p>config.json 定义用户在控制台部署应用时需要填写的表单。</p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：国际化</p>
<h3 id="19-应用实例调用的脚本中环境变量在创建应用实例后变得不可用的问题">19. 应用实例调用的脚本中环境变量在创建应用实例后变得不可用的问题？</h3>
<p>如果我们在制作镜像的时候设置了一些环境变量，并在一些脚本文件中直接使用这些环境变量是没有问题的，
但在使用这个 image 实例化应用之后，这些环境变量会不可用。<br>
因此建议大家在编写脚本的时候重新再 export 一下环境变量，或者 source 一下环境变量的文件。 <br>
例如 export PGDATA=/data/pgsql/main 或者 source /etc/profile</p>
<h3 id="20-如何配置依赖其他集群的服务">20. 如何配置依赖其他集群的服务？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;links&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;redis_service&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.redis_service</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;mysql_service&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.mysql_service</span>}<span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">config.json</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;redis_service&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;Redis&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34; &#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;service&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tag&#34;</span>: [<span style="color:#e6db74">&#34;Redis&#34;</span>,<span style="color:#e6db74">&#34;redis&#34;</span>	],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;limits&#34;</span>: {<span style="color:#f92672">&#34;app-zydumbxo&#34;</span>: [<span style="color:#e6db74">&#34;appv-q1uwklp7&#34;</span>]},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;mysql_service&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;MySql&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34; &#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;service&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tag&#34;</span>: [<span style="color:#e6db74">&#34;MySql&#34;</span>,<span style="color:#e6db74">&#34;mysql&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;limits&#34;</span>: {<span style="color:#f92672">&#34;app-00r26u27&#34;</span>: []},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>其中 limits 参数的值为 app-id***: [app-version***]。若 version 列表为空，表示该应用所有版本均可支持。
如果配置了此参数，在控制台上新建集群的时候会出现当前实例所在的私网下存在的所依赖的服务。<br>
<img src="/appcenter/dev-platform/cluster-images/faq_depend.png" alt="faq_depend.png"></p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：links、limits</p>
<h3 id="21-执行操作失败时如何展示给用户错误提示">21. 执行操作失败时如何展示给用户错误提示？</h3>
<ul>
<li>
<p>制作 image 时，规划好 cmd 在不同出错情况下 exit code 值。</p>
</li>
<li>
<p>配置文件 locale/zh-cn.json 中定义：</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;err_code1&#34;</span>: <span style="color:#e6db74">&#34;禁止同时删除多个从节点&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>配置文件 locale/en.json 中定义：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;err_code1&#34;</span>: <span style="color:#e6db74">&#34;Permission denied to delete multiple slave nodes&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在执行操作 cmd 时，遇到 exit code 是 1 的情况时，会给用户如下提示：
<img src="/appcenter/dev-platform/cluster-images/err_code.png" alt="err_code.png"></p>
<h3 id="22-如何配置横向扩容">22. 如何配置横向扩容？</h3>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;nodes&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;tomcat_nodes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;container&#34;</span>: {<span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;kvm&#34;</span>,<span style="color:#f92672">&#34;zone&#34;</span>: <span style="color:#e6db74">&#34;jn1a&#34;</span>,<span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;img-h73eih5e&#34;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;loadbalancer&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.loadbalancer</span>}},
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;instance_class&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.instance_class</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;count&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.count</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;cpu&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.cpu</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;memory&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.tomcat_nodes.memory</span>}<span style="color:#960050;background-color:#1e0010">}</span>,             
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;advanced_actions&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;scale_horizontal&#34;</span>]   <span style="color:#960050;background-color:#1e0010">***请注意这里!!!</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>同时，如果在升级的同时要做一些其他的任务，可以在 service 的 upgrade 脚本里编写自己的内容。示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;services&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;scale_out&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pre_check&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/sbin/scale-out-pre-check.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/sbin/scale-out.sh&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;scale_in&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pre_check&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/sbin/scale-in-pre-check.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/sbin/scale-in.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">86400</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果配置了此参数，在控制台上集群节点列表上会出现新增节点的按钮。
<img src="/appcenter/dev-platform/cluster-images/faq_scale.png" alt="faq_scale.png"></p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：advanced_actions、scale_horizontal、scale_out、scale_in</p>
<h3 id="23-如何支持集群切换私网网络">23. 如何支持集群切换私网网络？</h3>
<p>变换网络 (change_vxnet) 如果您的应用支持切换网络可以加上 change_vxnet。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.name</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.description</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;vxnet&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.vxnet</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;backup_policy&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;device&#34;</span><span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;advanced_actions&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;change_vxnet&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>如果配置了此参数，在控制台上集群列表选中集群右键会出现切换私有网络菜单。
<img src="/appcenter/dev-platform/cluster-images/faq_vxnet.png" alt="faq_vxnet.png"></p>
<blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：advanced_actions、change_vxnet</p>
<h3 id="24-如何将角色的某个节点直接绑定公网-ip">24. 如何将角色的某个节点直接绑定公网 IP？</h3>
<p>绑定公网 IP (associate_eip)<br>
如果该角色的节点需要直接绑定公网IP可以加上 associate_eip，</p>
<blockquote>
<p>绑定公网 IP 会给这个集群绑定默认集群防火墙, 其他集群如果需要访问这个集群请在集群防火墙中添加对应放行规则。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.name</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.description</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;vxnet&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.vxnet</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;backup_policy&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;device&#34;</span><span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;advanced_actions&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [<span style="color:#e6db74">&#34;associate_eip&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><blockquote>
<p>具体配置请参考文档 <a href="/appcenter/dev-platform/cluster-developer-guide/specifications/specifications">云应用开发模板规范 - 完整版</a></p>
</blockquote>
<p><strong>关键字</strong>：advanced_actions、associate_eip</p>
<h3 id="25-如何获取依赖其他集群的服务的-appid-和-appversionid">25. 如何获取依赖其他集群的服务的 AppID 和 AppVersionID？</h3>
<p>在配置依赖服务的时候，配置参数需要知道所依赖的服务的 AppID 和 AppVersionID。</p>
<p>在<a href="http://appcenter.yiqiyun.net.cn/apps/">AppCenter应用开发</a>搜索找到你需要的应用，打开可以看到相关信息。</p>
<p><img src="/appcenter/dev-platform/cluster-images/faq_appid.png" alt="faq_appid.png"></p>
<h3 id="26-能否提供一些-confd-templates即-tmpl-文件的使用例子">26. 能否提供一些 confd templates（即 tmpl 文件）的使用例子？</h3>
<p>示例1：</p>
<p>获取集群中所有节点的 ip 地址，range 循环的用法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>{{range <span style="color:#75715e">$</span>dir := lsdir &#34;/hosts&#34;}}
</span></span><span style="display:flex;"><span>    {{<span style="color:#75715e">$</span>sid := printf &#34;/hosts/%s/sid&#34; <span style="color:#75715e">$</span>dir}}
</span></span><span style="display:flex;"><span>    {{<span style="color:#75715e">$</span>ip := printf &#34;/hosts/%s/ip&#34; <span style="color:#75715e">$</span>dir}}
</span></span><span style="display:flex;"><span>        server.{{getv <span style="color:#75715e">$</span>sid}}={{getv <span style="color:#75715e">$</span>ip}}:2888:3888
</span></span><span style="display:flex;"><span>{{end}}
</span></span></code></pre></div><p>confd service restart 刷新后的信息为</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>server.1=192.168.100.2:2888:3888
</span></span><span style="display:flex;"><span>server.2=192.168.100.3:2888:3888
</span></span><span style="display:flex;"><span>server.3=192.168.100.4:2888:3888
</span></span></code></pre></div><p>示例 2：</p>
<p>定义一个变量并使用这个变量</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>{{<span style="color:#75715e">$</span>tomcat_user :=getv &#34;/env/tomcat_user&#34;}}
</span></span><span style="display:flex;"><span>{{<span style="color:#75715e">$</span>tomcat_pwd :=getv &#34;/env/tomcat_pwd&#34;}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;user username=&#34;{{<span style="color:#75715e">$</span>tomcat_user}}&#34; password=&#34;{{<span style="color:#75715e">$</span>tomcat_pwd}}&#34; roles=&#34;manager-gui&#34; /&gt;
</span></span><span style="display:flex;"><span>&lt;user username=&#34;tomcat&#34; password=&#34;{{<span style="color:#75715e">$</span>tomcat_pwd}}&#34; roles=&#34;standard,manager-script,manager-jmx,manager-status&#34; /&gt;
</span></span></code></pre></div><p>示例3：
获取一个key的值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>max_connections= {{getv &#34;/env/max_connections&#34;}}
</span></span></code></pre></div><p>示例4：
对算术的支持 div</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>{{<span style="color:#75715e">$</span>shared_buffers := div (getv &#34;/host/memory&#34;) 4}}
</span></span></code></pre></div><p>示例5：
if else 的用法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>{{<span style="color:#75715e">$</span>SyncStreamRepl := getv &#34;/env/SyncStreamRepl&#34;}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{if eq <span style="color:#75715e">$</span>SyncStreamRepl &#34;No&#34; }}
</span></span><span style="display:flex;"><span>    synchronous_standby_names =  &#39;&#39;
</span></span><span style="display:flex;"><span>{{else}}
</span></span><span style="display:flex;"><span>    synchronous_standby_names =  &#39;*&#39;
</span></span><span style="display:flex;"><span>{{end}}
</span></span></code></pre></div><p>示例6：
split的用法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tmpl" data-lang="tmpl"><span style="display:flex;"><span>{{ <span style="color:#75715e">$</span>replicaIPs := split (getv &#34;/host/ip&#34;) &#34;.&#34; }}
</span></span><span style="display:flex;"><span>{{index <span style="color:#75715e">$</span>replicaIPs 0}}.{{index <span style="color:#75715e">$</span>replicaIPs 1}}.{{index <span style="color:#75715e">$</span>replicaIPs 2}}.0/24
</span></span></code></pre></div><p>更多 template 的函数使用示例请参考<a href="https://github.com/yunify/confd/blob/master/docs/templates.md">yunify/confd</a></p>
<h3 id="27-confd-日志显示-key-找不到的错误信息">27. confd 日志显示 key 找不到的错误信息</h3>
<p>经常会在 confd 的日志文件中看到类似于如下错误信息，通常情况是在 toml 文件没 watch 该 key，或者该 key 不存在，
可以通过 <code>curl http://metadata/self</code> 查看。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>2016-10-11T13:54:41+08:00 i-lvn35udh confd[1531]: ERROR template: index.html.tmpl:2:7: executing &#34;index.html.tmpl&#34; at &lt;getv &#34;/self/host/sid...&gt;: error calling getv: key does not exist: /self/host/sid
</span></span></code></pre></div><h3 id="28-上传配置包时报错配置验证失败报configjson-not-valid-json错误">28. 上传配置包时报错：配置验证失败,报[config.json] Not valid json错误？</h3>
<p>需要检查 config.json 文本内容，是否有中文符号或其他不符合 json 格式的部分，可以通过在线工具验证合法性，比如 <a href="http://jsonlint.com/">jsonlint</a>。<br>
同时配置包中文件不支持 &ldquo;UTF-8 Unicode (with BOM) text&rdquo; 文本格式，windows下的编辑器编辑文件默认是此格式也会报此错误，
可通过 &ldquo;格式-&gt; 以utf-8无BOM格式编码&rdquo; 进行转换。</p>
<h3 id="29-我在测试的时候发现设置的服务价格没起作用原因是什么">29. 我在测试的时候发现设置的服务价格没起作用，原因是什么？</h3>
<p>自己测试自己的应用的时候是不收取服务费用的，一旦上线用户使用的时候会收取您设置的服务费用。</p>
<h3 id="30-节点的启动停止命令执行出错请确保命令写完整的全路径">30. 节点的启动/停止命令执行出错，请确保命令写完整的全路径。</h3>
<p>当定义的应用的启动/停止/监控命令执行有问题，例如
文件定义如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&#34;start&#34;:&#34;your_script&#34;
</span></span></code></pre></div><p>服务日志如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>2017-04-13 12:14:19,318 ERROR Failed to execute the [cmd:your_script, id:JPwqtXY56Mp22t0RsqkDtQVu3hQLxxxx] in the node [cln-pwgxxxxx]
</span></span></code></pre></div><p>请确认起停的命令要写全路径。例如</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&#34;start&#34;:&#34;/bin/your_script&#34;
</span></span></code></pre></div><p>要保证脚本在任意路径下调用都可以成功返回。<br>
例如在创建好的集群中，执行如下命令返回正常。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /tmp  
</span></span><span style="display:flex;"><span>/opt/yourscript.sh
</span></span></code></pre></div><h3 id="31-使用-kvm-作为镜像模板时应用创建资源失败登录创建的节点发现文件系统变成只读该如何排查">31. 使用 kvm 作为镜像模板时，应用创建资源失败，登录创建的节点发现文件系统变成只读，该如何排查？</h3>
<p>日志如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>2017-04-17 11:03:48,800 CRITICAL Mount volume [{&#39;mount_point&#39;: &#39;/data&#39;, &#39;mount_options&#39;: &#39;&#39;, &#39;filesystem&#39;: &#39;ext4&#39;}] on node [cln-bo73222b] failed
</span></span></code></pre></div><blockquote>
<p>请确保在制作镜像时正常关机，保证磁盘正常卸载。</p>
</blockquote>
<h3 id="32-使用说明和服务条款的-markdown-语法说明">32. 使用说明和服务条款的 Markdown 语法说明</h3>
<ul>
<li>支持标准的 <a href="https://www.appinn.com/markdown/">Markdown 语法</a>，同时你也可以直接使用 HTML 代码</li>
<li>Markdown 转换后的内容是没有样式，如果你想再添加样式，可以将下面的 HTML 代码添加到你输入的内容之前：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.bootcss.com/foundation/6.3.1/css/foundation.min.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>&gt;
</span></span></code></pre></div><blockquote>
<p>在使用说明中，如果只输入一个网址，用户在查看使用说明时会直接跳转到该网址</p>
</blockquote>
<h3 id="33-如果只想用云应用开发框架管理纯云服务器集群">33. 如果只想用云应用开发框架管理纯云服务器集群</h3>
<p>可以不用装亿栖云提供的 App agent，以下是样例。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">config.json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;properties&#34;</span>: [{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;cluster&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Sample cluster properties&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;properties&#34;</span>: [{
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The name of the Sample service&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;Sample&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>        }, {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;description&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;description&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The description of the Sample service&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>        }, {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;vxnet&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;VxNet&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Choose a vxnet to join&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>        }, {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;role_name1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;role_name1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;role-based role_name1 properties&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;properties&#34;</span>: [{
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;cpu&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;CPU&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;CPUs of each node&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;range&#34;</span>: [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">16</span>],
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>            }, {
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;memory&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;Memory&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Memory of each node&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#ae81ff">2048</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;range&#34;</span>: [<span style="color:#ae81ff">2048</span>, <span style="color:#ae81ff">8192</span>, <span style="color:#ae81ff">16384</span>, <span style="color:#ae81ff">32768</span>, <span style="color:#ae81ff">49152</span>],
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>            }, {
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;count&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;Count&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Number of nodes for the cluster to create&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;max&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;min&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>            }, {
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;volume_size&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;Volume Size&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The volume size for each instance&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;min&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;max&#34;</span>: <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;step&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>            }, {
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;instance_class&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;resource type&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The instance type for the cluster to run, such as high performance, high performance plus&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;range&#34;</span>: [
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                 ],
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>            }]
</span></span><span style="display:flex;"><span>        }]
</span></span><span style="display:flex;"><span>    }]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>** 其中 <code>img-hlhql5ea</code> 是没有安装 app agent 的镜像，<code>agent_installed</code> 用来标识此 role 没有安装 agent **</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.name</span>}}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.description</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;vxnet&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.vxnet</span>}<span style="color:#960050;background-color:#1e0010">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;nodes&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;role_name1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;container&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;kvm&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;zone&#34;</span>: <span style="color:#e6db74">&#34;jn1a&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;img-hlhql5ea&#34;</span>
</span></span><span style="display:flex;"><span>         },
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">&#34;agent_installed&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">&#34;instance_class&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.role_name1.instance_class</span>}},
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;count&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.role_name1.count</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;cpu&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.role_name1.cpu</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;memory&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#960050;background-color:#1e0010">{cluster.role_name1.memory</span>}<span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;volume&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">&#34;size&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{cluster.role_name1.volume_size</span>}},
</span></span><span style="display:flex;"><span>             <span style="color:#e6db74">&#34;mount_point&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;/test_data&#34;</span>,
</span></span><span style="display:flex;"><span>             <span style="color:#e6db74">&#34;filesystem&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;ext4&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="34-如何使用环境变量里的-accesskey-类型数据">34. 如何使用环境变量里的 accesskey 类型数据？</h3>
<p>如果需要用户提供 API 密钥并写入环境变量，可以使用数据类型 accesskey</p>
<p>示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">cluster.json.mustache</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;env&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;access_key&#34;</span>: {<span style="color:#960050;background-color:#1e0010">{env.access_key</span>}}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">config.json</span> <span style="color:#960050;background-color:#1e0010">文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;env&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;application configuration properties&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;properties&#34;</span>: [{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;access_key&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;access_key_id&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;access key ID&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;accesskey&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>    }]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>通过如下方法获取用户 API 密钥及其私钥：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://metadata/self/env/access_key/access_key_id
</span></span><span style="display:flex;"><span>curl http://metadata/self/env/access_key/secret_access_key
</span></span></code></pre></div><p><strong>关键字</strong>：env、accesskey、metadata</p>
<h3 id="35-环境变量里如何支持层级联动关系">35. 环境变量里如何支持层级联动关系？</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;env&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;application configuration properties&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;properties&#34;</span>: [{
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;s3_type&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;s3.type&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Type of s3 compatible object store&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;range&#34;</span>: [<span style="color:#e6db74">&#34;none&#34;</span>,<span style="color:#e6db74">&#34;minio&#34;</span>,<span style="color:#e6db74">&#34;对象存储服务OIS&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>    }, {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;access_key&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;access.key&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Access key used to access 对象存储服务OIS object store&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;accesskey&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;dependencies&#34;</span>:[
</span></span><span style="display:flex;"><span>        {<span style="color:#f92672">&#34;refkey&#34;</span>:<span style="color:#e6db74">&#34;s3_type&#34;</span>,<span style="color:#f92672">&#34;values&#34;</span>:[<span style="color:#e6db74">&#34;对象存储服务OIS&#34;</span>],<span style="color:#f92672">&#34;operator&#34;</span>:<span style="color:#e6db74">&#34;in&#34;</span>}
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>    }, {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;s3_access_key&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;s3.access.key&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Access key used to access MinIO object store&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;password&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;AKIAIOSXODNN7EXAMPLE&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^.{20}$&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;changeable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;dependencies&#34;</span>:[
</span></span><span style="display:flex;"><span>        {<span style="color:#f92672">&#34;refkey&#34;</span>:<span style="color:#e6db74">&#34;s3_type&#34;</span>,<span style="color:#f92672">&#34;values&#34;</span>:[<span style="color:#e6db74">&#34;minio&#34;</span>],<span style="color:#f92672">&#34;operator&#34;</span>:<span style="color:#e6db74">&#34;in&#34;</span>}
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>    }, {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;s3_secret_key&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;s3.secret.key&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Secret key used to access MinIO object store&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;password&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;default&#34;</span>: <span style="color:#e6db74">&#34;wJalrXUtqFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^.{40}$&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;changeable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;dependencies&#34;</span>:[
</span></span><span style="display:flex;"><span>        {<span style="color:#f92672">&#34;refkey&#34;</span>:<span style="color:#e6db74">&#34;s3_type&#34;</span>,<span style="color:#f92672">&#34;values&#34;</span>:[<span style="color:#e6db74">&#34;minio&#34;</span>],<span style="color:#f92672">&#34;operator&#34;</span>:<span style="color:#e6db74">&#34;in&#34;</span>}
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;required&#34;</span>: <span style="color:#e6db74">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>当 s3_type 值为 none 时，access_key、s3_access_key 和 s3_secret_key 都不显示
<img src="/appcenter/dev-platform/cluster-images/s3_type_none.png" alt="s3_type_none.png"></p>
<p>当 s3_type 值为 minio 时，s3_access_key 和 s3_secret_key 显示，access_key 不显示
<img src="/appcenter/dev-platform/cluster-images/s3_type_minio.png" alt="s3_type_minio.png"></p>
<p>当 s3_type 值为 对象存储服务OIS 时，access_key 显示，s3_access_key 和 s3_secret_key 都不显示。</p>
<h3 id="36-如何定义原地升级方式">36. 如何定义原地升级方式？</h3>
<ul>
<li>cluster.json.mustache 的 upgrading_policy 定义为 in-place-parallel 或 in-place-sequential，同时定义 in-place-upgrade-nodes 信息：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;upgrading_policy&#34;</span>: <span style="color:#e6db74">&#34;in-place-parallel&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;in-place-upgrade-nodes&#34;</span>: [{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;container&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;snapshot&#34;</span>: <span style="color:#e6db74">&#34;ss-skhdp1m1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;zone&#34;</span>: <span style="color:#e6db74">&#34;jn1&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;copy&#34;</span>: [{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mount_role&#34;</span>: <span style="color:#e6db74">&#34;master&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mount_point&#34;</span>: <span style="color:#e6db74">&#34;/data1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mount_options&#34;</span>: <span style="color:#e6db74">&#34;defaults,noatime&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;ext4&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;/data1/upgrade1/bin&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;destination&#34;</span>: <span style="color:#e6db74">&#34;/data/bin&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mount_role&#34;</span>: <span style="color:#e6db74">&#34;slave&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mount_point&#34;</span>: <span style="color:#e6db74">&#34;/data2&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mount_options&#34;</span>: <span style="color:#e6db74">&#34;defaults,noatime&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;ext4&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;/data2/upgrade1/bin&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;destination&#34;</span>: <span style="color:#e6db74">&#34;/data/bin&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><table>
<thead>
<tr>
<th>参数</th>
<th>-</th>
<th>-</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>upgrading_policy</td>
<td>-</td>
<td>-</td>
<td>定义版本升级的模式，支持 in-place-parallel 或 in-place-sequential</td>
</tr>
<tr>
<td>in-place-upgrade-nodes</td>
<td>-</td>
<td>-</td>
<td>原地升级时，需要使用的备份以及拷贝操作信息，定义在里面。</td>
</tr>
<tr>
<td>-</td>
<td>container</td>
<td>-</td>
<td>备份信息，必填项。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>snapshot</td>
<td>备份 ID。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>zone</td>
<td>备份制作时所属区域。</td>
</tr>
<tr>
<td>-</td>
<td>copy</td>
<td>-</td>
<td>定义由备份恢复的硬盘，原地升级时拷贝操作相关信息。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>mount_role</td>
<td>将备份恢复的硬盘，挂载到哪个角色节点上，该角色所有节点都会挂载硬盘。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>mount_point</td>
<td>备份恢复的硬盘的挂载路径，比如 /data1。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>mount_options</td>
<td>描述数据盘的挂接方式，默认值 ext4 是 defaults,noatime，xfs 是 rw,noatime,inode64,allocsize=16m。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>filesystem</td>
<td>备份恢复的硬盘的文件系统类型。目前支持 ext4 和 xfs，默认是 ext4。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>source</td>
<td>需要拷贝数据的源目录，也就是 mount_point 下的目录。</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td>source</td>
<td>需要拷贝数据的目标目录。拷贝失败时会删除该目录，拷贝成功不做任何处理，建议该目录使用一个临时目录，后面开发者可以在 services 下 upgrade 操作定义后续的操作。</td>
</tr>
</tbody>
</table>
<ul>
<li>由硬盘制作备份时，需要制作 qcow2 格式的全量备份。
<pre tabindex="0"><code>./create-snapshots -r vol-pisotyhp -F 1 -m qcow2
</code></pre></li>
</ul>
<h3 id="37-升级操作时如何给用户弹出提示">37. 升级操作时如何给用户弹出提示？</h3>
<ul>
<li>配置文件 locale/zh-cn.json 中定义：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;notice_when_upgrade&#34;</span>: <span style="color:#e6db74">&#34;此版本包含不兼容消息队列消息队列Kafka 1.x 版本的改动，可能会导致业务代码异常退出并无法回退！为避免损失，强烈建议先创建一个新集群进行验证，确保可以工作以后再进行升级操作。消息队列Kafka 2.3 版本说明请查看官方文档：https://消息队列Kafka.apache.org/documentation/&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>配置文件 locale/en.json 中定义：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;notice_when_upgrade&#34;</span>: <span style="color:#e6db74">&#34;The new version app may need refit your 消息队列Kafka consumer code! Make sure you are using the new config!!!&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="/appcenter/dev-platform/cluster-images/notice_when_upgrade.png" alt="notice_when_upgrade.png"></p>
<h3 id="38-串行纵向扩容或滚动升级时如何按照一定顺序进行操作">38. 串行纵向扩容或滚动升级时，如何按照一定顺序进行操作？</h3>
<p>一些应用同一角色内多个节点之间地位不同，仍然会有主从关系。在纵向扩容或滚动升级时，希望优先操作从节点，最后操作主节点，以达到最少主从切换的目的。
同一角色内多个节点之间的身份，只有应用实例自己知道，可以通过定义 get_nodes_order 的方式来实现这个目的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;services&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;get_nodes_order&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;event&#34;</span>: [<span style="color:#e6db74">&#34;upgrade&#34;</span>, <span style="color:#e6db74">&#34;rollback&#34;</span>, <span style="color:#e6db74">&#34;scale_vertical&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;/opt/myapp/bin/get-nodes-order.sh&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>其中 event 的可选值为：upgrade, rollback, scale_vertical。表示在定义的生命周期到来时，使用 get_nodes_order 中 cmd 的执行结果作为该生命周期节点的操作顺序。
<code>{event: xx}</code> 会作为 cmd 的 $1 传入。</p>
<p>例：</p>
<p>集群 cl-12345678 有 3 个节点，分别是：cln-11111111, cln-22222222, cln-33333333。
<code>/opt/myapp/bin/get-nodes-order.sh</code> 的返回结果为：<code>cln-33333333,cln-22222222,cln-11111111</code>，逗号分隔的节点 id 列表。
则在滚动升级和串行纵向扩容时，按照 <code>cln-33333333,cln-22222222,cln-11111111</code> 的节点顺序，执行这个生命周期下的操作。</p>

	
	
	<div class="page-meta-pagination border-top">
		

		
	</div>
	<div class="page-meta-pagination_word">
		这篇文档解决了您的问题吗？
		<div class="doc_fix_click fix-background-like" data-flag='1'>
			<span>0</span>
		</div>
		<div class="doc_fix_click fix-background-unlike" data-flag='0'>
			<span>0</span>
		</div>
		<input type="hidden" id="doc_fix_flag" value="0">
	</div>
</div>
<script src="/js/content.js"></script>
<script src="/js/viewer.min.js"></script>
<link rel="stylesheet" href="/css/viewer.min.css">
<script>
	var viewer = new Viewer(document.querySelector('.td-content'), {
		url: 'src'
	})
</script>

          </main>
        </div>
      </div>
    </div>
         
    
<script src="/css/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
</script>






<script src="/js/main.min.7d5b92c4889cf0554b0ea5e2309b0b81b196aa7c9a235632938a25d9fc4d8a7c.js" integrity="sha256-fVuSxIic8FVLDqXiMJsLgbGWqnyaI1Yyk4ol2fxNinw=" crossorigin="anonymous"></script>



  </body>
</html>