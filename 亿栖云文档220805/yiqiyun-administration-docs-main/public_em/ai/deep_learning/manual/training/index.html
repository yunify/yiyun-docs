<!doctype html>
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="generator" content="Hugo 0.101.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="icon" href="http://yiqiyun.sd.cegn.cn/static/assets/images/favicon.ico?v=1632342842" type="image/x-icon">

<title>训练和推理 | 亿栖云文档</title>

<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/autocomplete.css" rel="stylesheet" />
<link href="/css/copy-to-clipboard.css" rel="stylesheet" />


    



<link rel="preload" href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" as="style">
<link href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" rel="stylesheet" integrity="">


<script
  src="/js/jquery-2.2.4.js?v=1510299508"
  ></script>
	

<script src="/js/common.js?v=1.3"></script>

  </head>
  <body class="td-page">
    <header>
      <div class="nav-wrapper ">
  <nav class="navbar navmenu"  style="display:none;" >
    <div class="container with-no-position doc-container-width ">
      <div class="navbar-brand" id="search-mobile-logo">
        <a class="navbar-item logo" href="http://www.yiqiyun.net.cn">
          <img src="/images/yiqiyun_logo.png" alt="logo" style="height: 32px;width: 120px;">
        </a>
      </div>
      <div class="media-content column is-centered is-5 search-mobile">
        <form action="/search" method="GET">
          <div class="control has-icons-right docs-search-input">
            <input class="input" id="search-bar" name="q" type="search" placeholder="搜索" autocomplete="off">
            <span class="icon is-right" id="mobile-search">
              <img src="/images/icons/search.svg">
            </span>
          </div>
        </form>
        <a href="javascript:;" class="search-mobile-icon"><img src="/images/icons/search.svg"></a>
      </div>
      <div class="navbar-end is-hidden-mobile header-account">
        <div class="navbar-item">
          <div class="field is-grouped">
            <p class="control navbar-user">
              <a class="nav-item" href="http://www.yiqiyun.cn">服务商门户</a>
            </p>
            <p class="control navbar-user">
              <a class="nav-item" href="http://console.yiqiyun.cn/login">登录</a>
            </p>
            <div class="navbar-user">
              <a class="button is-primary j-signup" href="http://console.yiqiyun.cn/signup/" data-gio="{id:'createPageView',var:{sourceType_var:'导航栏'}}" style="background-color: #55a8fd">注册</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  
  <nav class="navbar navmenu navbar-index">
    <div class="container is-size-7 doc-container-width " data-path="1">


	
	
		

  
  

  
  

  
  

  


	
	




  


	
	
	<a href="/ai/deep_learning/" class="has-text-primary">深度学习平台</a><img class="container_span_space" src="/images/icons/path.svg">
	




  


	
	
	<a href="" class="has-text-primary">操作指南</a><img class="container_span_space" src="/images/icons/path.svg">
	




  



	
	<span class="crumb-last-color">训练和推理</span>
	



	

</div>


  </nav>
  
</div>
    </header>
    <div class="container td-outer doc-container-width container-min-height">
      <div class="td-main">
		
			<h1 class="console-tree-title">操作指南</h1>
		
        <div class="row flex-xl-nowrap">
		  
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none td-sidebar-menu">
            





<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2" id="td-section-nav">
    <div class="nav-item dropdown d-block ">
      
      
      













<span class="menu__title--collapse active display-hide"
  data-depth="0">
  深度学习平台
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/deep_learning/ data-link=/ai/deep_learning/manual/training/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/intro/intro/"
      class="menu__title  "
      data-depth="1">什么是深度学习平台</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/intro/list/"
      class="menu__title  "
      data-depth="1">产品系列</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/intro/superiority/"
      class="menu__title  "
      data-depth="1">产品优势</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/intro/scene/"
      class="menu__title  "
      data-depth="1">应用场景</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/billing/price/"
      class="menu__title  "
      data-depth="1">计费说明</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quickstart/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/quickstart/deploy_app/"
      class="menu__title  "
      data-depth="1">步骤一：部署 Deep Learning 应用</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/quickstart/login_vm/"
      class="menu__title  "
      data-depth="1">步骤二：登录主机</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/quickstart/start_env/"
      class="menu__title  "
      data-depth="1">步骤三：启动训练环境</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/deploy/"
      class="menu__title  "
      data-depth="1">部署 Deep Learning 服务</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/manual/"
      class="menu__title  "
      data-depth="1">深度学习平台启动指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/caffe/"
      class="menu__title  "
      data-depth="1">Caffe 使用指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/tensorflow/"
      class="menu__title  "
      data-depth="1">TensorFlow 使用指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/pytorch/"
      class="menu__title  "
      data-depth="1">PyTorch 使用指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/keras/"
      class="menu__title  "
      data-depth="1">Keras 使用指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/testing/"
      class="menu__title  "
      data-depth="1">Deep Learning 性能测试</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/training/"
      class="menu__title active "
      data-depth="1">训练和推理</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/model/"
      class="menu__title  "
      data-depth="1">附表1</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/manual/form/"
      class="menu__title  "
      data-depth="1">附表2</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_01/"
      class="menu__title  more-space"
      data-depth="1">容器中 TensorBoard 或者 jupyter 服务已经启动，如何访问？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_02/"
      class="menu__title  more-space"
      data-depth="1">为什么在 import tensorflow 的时候显示 no module named tensorflow？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_03/"
      class="menu__title  more-space"
      data-depth="1">运行 GPU 版容器，为什么会出现错误 libcuda.so.1: cannot open shared object file: No such file or directory？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_04/"
      class="menu__title  more-space"
      data-depth="1">容器启动后，目录 /root 下可能存在 test/ caffe/ opencv/ nccl/ 等文件夹，可以删除吗？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_05/"
      class="menu__title  more-space"
      data-depth="1">如何查看深度学习平台的 GPU 使用率？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_06/"
      class="menu__title  "
      data-depth="1">为什么 TensorBoard UI 加载失败？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/deep_learning/faq/faq_07/"
      class="menu__title  "
      data-depth="1">pip 安装 Python module 速度比较慢怎么办</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  推理引擎
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/inference/ data-link=/ai/deep_learning/manual/training/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/inference/intro/intro/"
      class="menu__title  "
      data-depth="1">什么是推理引擎</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/inference/intro/list/"
      class="menu__title  "
      data-depth="1">部署方式</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/inference/intro/superiority/"
      class="menu__title  "
      data-depth="1">产品优势</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/inference/billing/price/"
      class="menu__title  "
      data-depth="1">计费说明</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quickstart/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/inference/quickstart/deploy_app/"
      class="menu__title  "
      data-depth="1">部署 Inference Engine 应用</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/ai/deep_learning/manual/training/>
  
  
  
  
  
  <li>
    <a href="/ai/inference/manual/depoly_model/"
      class="menu__title  "
      data-depth="1">部署模型</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/inference/manual/use_model/"
      class="menu__title  "
      data-depth="1">使用模型</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/inference/manual/log/"
      class="menu__title  "
      data-depth="1">查看日志</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/inference/manual/testing/"
      class="menu__title  "
      data-depth="1">性能测试</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/ai/inference/manual/launching/"
      class="menu__title  "
      data-depth="1">负载均衡</a>
  </li>
  
  
</ul>


  
  
</ul>


      
    </div>
  </nav>
</div>


<script src="/js/sidebar-tree.js"></script>


          </div>
          <div class="d-none col-md-2 d-xl-block d-md-block col-xl-2 td-toc d-print-none">
            


<h3 class="nav-title">本页目录</h3>


<nav id="TableOfContents">
  <ul>
    <li><a href="#图像分类">图像分类</a>
      <ul>
        <li><a href="#inception-v1的训练和测试">Inception V1的训练和测试</a></li>
      </ul>
    </li>
    <li><a href="#目标检测">目标检测</a>
      <ul>
        <li><a href="#fasterrcnn-目标检测">FasterRCNN 目标检测</a></li>
        <li><a href="#fasterrcnn训练">FasterRCNN训练</a></li>
        <li><a href="#fasterrcnn推理">FasterRCNN推理</a></li>
      </ul>
    </li>
    <li><a href="#人脸识别">人脸识别</a>
      <ul>
        <li><a href="#facenet-人脸相似度计算">FaceNet 人脸相似度计算</a></li>
      </ul>
    </li>
    <li><a href="#语音识别">语音识别</a>
      <ul>
        <li><a href="#kaldi-中文语音识别">Kaldi 中文语音识别</a></li>
      </ul>
    </li>
    <li><a href="#nlp">NLP</a></li>
  </ul>
</nav>




          </div>
          <main class="col-12 col-md-7 col-xl-7" role="main">
            
  

            
            
            
<div class="td-content">
	<div class="td-sidebar-section-title content-index">
		<img class="is-40x40" src="/images/icons/book-open.svg">
		<h3 class="doc_vice_title">操作指南</h3>
		<a href="javascript:;" class="nav-trigger">&nbsp;<span aria-hidden="true"></span></a>
	</div>
	<div class="td-page-top">
		<h1>训练和推理</h1>
		






<div class="td-page-meta page-meta-actions ml-2 pb-1 mb-0">







</div>



	</div>
	<div class="page-meta-lastmod text-muted ">
	更新时间 2020-12-01

</div>

	<input type="hidden" id="content_console" value="1">
	
	
	<div class="lead"></div>
	

	
	<h2 id="图像分类">图像分类</h2>
<h3 id="inception-v1的训练和测试">Inception V1的训练和测试</h3>
<p>为了方便用户测试和使用，我们选择了 Google 的 Inception v1(GoogLeNet)，对30幅猫和狗的图片进行简要的训练和推理测试(因为只使用30幅图片进行快速演示，所以未设置验证和测试图片，使用训练图片进行推理，简明验证权重和 BatchNormalization 等参数的保存)，能够在几分钟内完成从头训练 (Train from scratch)，保存权重，加载训练的权重进行推理等整个流程环节。并使用相同的代码，加载 Google 发布在 TensorFlow 工程中的预训练权重，测试对图片的推理。用户通过这个示例，能够快速了解平台并部署自己的深度学习模型。</p>
<p>测试步骤如下：</p>
<ol>
<li>下载测试代码并解压</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/ubuntu
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/models/Slim-InceptionV1.tar
</span></span><span style="display:flex;"><span>tar xvf Slim-InceptionV1.tar
</span></span><span style="display:flex;"><span>cd Slim-InceptionV1
</span></span></code></pre></div><ol start="2">
<li>激活 VirtualEnv</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>source /home/ubuntu/workspaces/py2/bin/activate
</span></span></code></pre></div><ol start="3">
<li>训练30幅图片的猫狗2分类</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python train.py
</span></span></code></pre></div><ol start="4">
<li>训练在 GPU 上会在1分钟内完成，如下</li>
</ol>
<h4 id="inception-v1-训练过程">Inception v1 训练过程</h4>
<p><img src="../_images/inception_v1_train1.png" alt="Inception v1 训练过程"></p>
<h4 id="inception-v1-训练结果">Inception v1 训练结果</h4>
<p><img src="../_images/inception_v1_train2.png" alt="Inception v1 训练结果"></p>
<p>使用刚才训练的权重对图片进行推理</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python test.py picture/dog/dog1.jpg
</span></span><span style="display:flex;"><span>python test.py picture/cat/cat1.jpg
</span></span></code></pre></div><p>从结果可以看出，保存的权重对图片进行了较好的2分类。</p>
<h4 id="inception-v1-推理">Inception v1 推理</h4>
<p><img src="../_images/inception_v1_test.png" alt="Inception v1 推理"></p>
<p>使用预训练权重对图片进行推理</p>
<p>刚才使用的只是2分类的自己训练的权重，也可以直接使用 Google 发布在 TensorFlow 工程中使用 ImageNet 训练的1000分类预训练权重，或者基于这个预训练结果进行迁移学习。这里简要演示使用预训练权重推理的过程</p>
<ol>
<li>下载并解压预训练权重</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/models/TensorFlow-Slim%20image%20classification/inception_v1_2016_08_28.tar.gz
</span></span><span style="display:flex;"><span>tar xvf inception_v1_2016_08_28.tar.gz
</span></span></code></pre></div><ol start="2">
<li>使用预训练权重进行推理</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python test_pretrained.py picture/dog/dog2.jpg
</span></span><span style="display:flex;"><span>python test_pretrained.py picture/cat/cat2.jpg
</span></span></code></pre></div><p>这里加载了 ImageNet 的标签文本，并依据 softmax 结果输出标签值，所以可以显示出图像分类的文本结果</p>
<p><strong>Inception v1 使用预训练权重推理</strong></p>
<p><img src="../_images/inception_v1_test_pretrained.png" alt="Inception v1 使用预训练权重推理"></p>
<h2 id="目标检测">目标检测</h2>
<h3 id="fasterrcnn-目标检测">FasterRCNN 目标检测</h3>
<p>源代码来自<a href="https://github.com/tensorpack/tensorpack">https://github.com/tensorpack/tensorpack</a>， 修改部分代码以使用 COCO 2017 数据集进行训练，并使用 ImageNet-R50 Backbone 网络和 COCO 2017 数据集训练了 300000 iterations，保存对应的 checkpoint ，增加 jupyter notebook 版测试程序，显示初步训练的结果，代码在对象存储<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/tensorpack.tar">下载</a>。基于 Python 3.6.5，需要安装 opencv-contrib-python 、 tensorpack 、 pycocotools 包。</p>
<h3 id="fasterrcnn训练">FasterRCNN训练</h3>
<p>激活 Python 3.6.5 环境，下载<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/tensorpack.tar">文件</a>后解压，然后在 tensorpack/coco 目录下，下载 COCO 2017 数据集文件并解压（这里已经包含了 annotations 和 val2017 ，仅需下载 train2017 和 test2017 ）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 下载并解压</span>
</span></span><span style="display:flex;"><span>source /home/ubuntu/workspaces/py3/bin/activate
</span></span><span style="display:flex;"><span>cd /data
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/models/tensorpack.tar
</span></span><span style="display:flex;"><span>tar xvf tensorpack.tar
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下载 COCO 2017 数据集（数据集将占用27GB空间，请确保硬盘空间充足）</span>
</span></span><span style="display:flex;"><span>cd tensorpack/coco
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/dataset/coco/train2017.zip
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/dataset/coco/test2017.zip
</span></span><span style="display:flex;"><span>tar xvf train2017.zip
</span></span><span style="display:flex;"><span>tar xvf test2017.zip
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从头开始训练</span>
</span></span><span style="display:flex;"><span>cd /data/tensorpack/examples/FasterRCNN
</span></span><span style="display:flex;"><span>python train.py --config MODE_MASK<span style="color:#f92672">=</span>False MODE_FPN<span style="color:#f92672">=</span>True BACKBONE.WEIGHTS<span style="color:#f92672">=</span>/data/tensorpack/modelzoo/FasterRCNN/ImageNet-R50-AlignPadding.npz DATA.BASEDIR<span style="color:#f92672">=</span>/data/tensorpack/coco/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从保存的 checkpoint 开始训练（注意代码在开始训练时将清空train_log/maskrcnn文件夹，请在开始训练前将需要保存的数据转移到其他文件夹，示例中转移到了train_log/bak文件夹）</span>
</span></span><span style="display:flex;"><span>python train.py --load<span style="color:#f92672">=</span>/data/tensorpack/examples/FasterRCNN/train_log/bak/model-10000.index --config MODE_MASK<span style="color:#f92672">=</span>False MODE_FPN<span style="color:#f92672">=</span>True BACKBONE.WEIGHTS<span style="color:#f92672">=</span>/data/tensorpack/modelzoo/FasterRCNN/ImageNet-R50-AlignPadding.npz DATA.BASEDIR<span style="color:#f92672">=</span>/data/tensorpack/coco/
</span></span></code></pre></div><p>训练开始后，将显示训练进度并在每个 epoch 完成后保存一次 checkpoint（每次保存占用约500MB空间，长时间训练请关注硬盘空间），如下图所示</p>
<p><img src="../_images/FasterRCNN_Train.png" alt="FasterRCNN训练"></p>
<h3 id="fasterrcnn推理">FasterRCNN推理</h3>
<p>激活 Python 3.6.5 环境，下载<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/tensorpack.tar">文件</a>后解压，然后在 tensorpack/examples/FasterRCNN 目录下，运行 jupyter notebook。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 下载并解压</span>
</span></span><span style="display:flex;"><span>source /home/ubuntu/workspaces/py3/bin/activate
</span></span><span style="display:flex;"><span>cd /data
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/models/tensorpack.tar
</span></span><span style="display:flex;"><span>tar xvf tensorpack.tar
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行 jupyter notebook</span>
</span></span><span style="display:flex;"><span>cd tensorpack/examples/FasterRCNN
</span></span><span style="display:flex;"><span>jupyter notebook --ip<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>ifconfig eth0 2&gt;/dev/null|awk <span style="color:#e6db74">&#39;/inet addr:/ {print $2}&#39;</span>|sed <span style="color:#e6db74">&#39;s/addr://&#39;</span><span style="color:#e6db74">`</span>
</span></span></code></pre></div><p>在浏览器中打开 jupyter notebook 的页面，打开 test.ipynb 并运行，将显示初步训练的权重对测试图片的目标检测结果。如下图所示</p>
<p><img src="../_images/FasterRCNN_Test.png" alt="FasterRCNN推理"></p>
<h2 id="人脸识别">人脸识别</h2>
<h3 id="facenet-人脸相似度计算">FaceNet 人脸相似度计算</h3>
<p>源代码来自<a href="https://github.com/davidsandberg/facenet">https://github.com/davidsandberg/facenet</a>，将预训练权重一起打包，增加 jupyter notebook 版测试程序，用来演示基本的 jupyter notebook 运行、交互和图像显示等功能，在对象存储<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/facenet.tar">下载</a>。基于 Python 3.6.5，需要安装 opencv-contrib-python 包。</p>
<p>激活 Python 3.6.5 环境，下载<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/facenet.tar">文件</a>后解压，然后在 facenet/src 目录下，运行 jupyter notebook。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 下载并解压</span>
</span></span><span style="display:flex;"><span>source /home/ubuntu/workspaces/py3/bin/activate
</span></span><span style="display:flex;"><span>cd /home/ubuntu/
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/models/facenet.tar
</span></span><span style="display:flex;"><span>tar xvf facenet.tar
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行 jupyter notebook</span>
</span></span><span style="display:flex;"><span>cd facenet/src
</span></span><span style="display:flex;"><span>jupyter notebook --ip<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>ifconfig eth0 2&gt;/dev/null|awk <span style="color:#e6db74">&#39;/inet addr:/ {print $2}&#39;</span>|sed <span style="color:#e6db74">&#39;s/addr://&#39;</span><span style="color:#e6db74">`</span>
</span></span></code></pre></div><p>在浏览器中打开 jupyter notebook 的页面，将看到如下内容</p>
<p><img src="../_images/facenet_1.png" alt="facenet 目录"></p>
<p>打开 facecomp.ipynb 并运行，在提示输入 model file path 时，输入预训练权重路径 20180408-102900 ；提示输入需要计算的照片时，输入 a1.jpg a2.jpg b1.jpg b2.jpg c1.jpg c2.jpg 。(这里随机选择了 VGGFace2 数据集中3个人6张照片作为示例)</p>
<p>将计算并显示6张人脸照片相互之间的距离，同一个人的照片，距离较近。如下图所示</p>
<p><img src="../_images/facenet_2.png" alt="facenet 运行"></p>
<p>用户可以使用对象存储中的 VGGFace2 或者自己的数据集，来训练 FaceNet，获得适用于自己业务的模型。</p>
<h2 id="语音识别">语音识别</h2>
<h3 id="kaldi-中文语音识别">Kaldi 中文语音识别</h3>
<p><a href="http://kaldi-asr.org">Kaldi</a> 是一个开源的语音识别工具箱，使用C++编写，在 Apache License v2.0 下发布，广泛用于语音识别研究者的研究工作，也用于一些工业语音识别系统的后台服务。
本示例演示 Kaldi 在 CPU 平台上的安装和配置，在配置 Kaldi 的基础上，使用 CVTE 公司在 <a href="http://kaldi-asr.org">http://kaldi-asr.org</a> 上开源的普通话 TDNN chain 模型完成普通话的语音识别，帮助用户快速熟悉语音识别工具箱的应用。</p>
<p>操作流程：下载 Kaldi 工具箱，编译 CPU 版本，并调用 CVTE 模型，对中文语音文件进行语音识别。
Kaidi 库地址：<a href="https://github.com/kaldi-asr/kaldi">https://github.com/kaldi-asr/kaldi</a>
CVTE 中文模型下载：<a href="http://kaldi-asr.org/models/2/0002_cvte_chain_model.tar.gz">CVTE Mandarin Model 下载</a> 来自：<a href="http://kaldi-asr.org">http://kaldi-asr.org</a></p>
<p>Kaldi 库编译安装和中文语音识别测试步骤如下，这里以 /data 目录下的操作来讲解</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 下载并编译 Kaldi 库 CPU 版本</span>
</span></span><span style="display:flex;"><span>cd /data
</span></span><span style="display:flex;"><span>git clone https://github.com/kaldi-asr/kaldi.git kaldi --origin golden
</span></span><span style="display:flex;"><span>cd /data/kaldi/tools
</span></span><span style="display:flex;"><span>make <span style="color:#f92672">(</span>注意这步不能用 -j 参数<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>cd /data/kaldi/src
</span></span><span style="display:flex;"><span>./configure --shared
</span></span><span style="display:flex;"><span>make -j <span style="color:#ae81ff">8</span> <span style="color:#f92672">(</span>可以调整为实际 CPU 核数<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下载 CVTE 预训练模型并解压到 Kaldi example 文件夹</span>
</span></span><span style="display:flex;"><span>cd /data
</span></span><span style="display:flex;"><span>wget http://kaldi-asr.org/models/2/0002_cvte_chain_model.tar.gz
</span></span><span style="display:flex;"><span>tar xvf 0002_cvte_chain_model.tar.gz
</span></span><span style="display:flex;"><span>mv cvte /data/kaldi/egs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下载推理测试脚本并测试语音识别</span>
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/models/kaldi_test.tar
</span></span><span style="display:flex;"><span>tar xvf kaldi_test.tar
</span></span><span style="display:flex;"><span>cd kaldi_test
</span></span><span style="display:flex;"><span>./multi_test.sh
</span></span></code></pre></div><p>测试语音识别效果如下图
<img src="../_images/kaldi.png" alt="kaldi"></p>
<p>测试脚本说明：CVTE 预训练模型需要对特征(这里第一步选用的是 FBank 特征)进行 CMVN 预处理后，再送入 DNN + HMM 进行处理，才能得到较好的识别效果，所以这里的测试脚本有3步。如果要测试其他音频文件，修改 wav.scp 和 utt2spk 文件。封装其他服务请参考<a href="http://kaldi-asr.org/doc/index.html">Kaldi 开发文档</a>，调用其 API 编写新的程序。</p>
<h2 id="nlp">NLP</h2>
<p>Gensim 处理中文维基百科语料 Word2Vec</p>
<p>使用常用的 gensim 自然语言处理包，对中文维基百科进行 Word2Vec 处理，并测试处理结果。示例代码在对象存储<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/gensim.tar">下载</a>。需要安装 gensim, jieba 包，以及 <a href="https://github.com/BYVoid/OpenCC">OpenCC</a> 应用程序。</p>
<p>激活 Python 3.6.5 环境，下载<a href="https://appcenter-deeplearning.sh1a.qingstor.com/models/gensim.tar">文件</a>后解压，然后在 gensim 目录下，进行如下操作</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 下载中文维基百科语料</span>
</span></span><span style="display:flex;"><span>wget https://appcenter-deeplearning.sh1a.qingstor.com/dataset/wiki/zhwiki-latest-pages-articles.xml.bz2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 处理语料为文本格式(得到 wiki.zht.text 文件)</span>
</span></span><span style="display:flex;"><span>python process_wiki.py zhwiki-latest-pages-articles.xml.bz2 wiki.zht.text
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 繁体转简体(得到 wiki.zhs.text )</span>
</span></span><span style="display:flex;"><span>opencc -i wiki.zht.text -o wiki.zhs.text -c t2s.json
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 切词并过滤英文和数字(得到 wiki_seg.txt )</span>
</span></span><span style="display:flex;"><span>python segment.py
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 训练Word2Vec(在4核8G CPU 平台，训练时间约2小时)</span>
</span></span><span style="display:flex;"><span>python train.py
</span></span></code></pre></div><p>训练完成后，在 gensim 目录下，运行 jupyter notebook，浏览器打开并运行 test.ipynb，对训练结果进行测试(本示例也包含了预训练模型，可直接运行该测试)，测试效果如下图</p>
<p><img src="../_images/gensim.png" alt="gensim"></p>

	
	
	<div class="page-meta-pagination border-top">
		
		<a href="/ai/deep_learning/manual/testing/" class="prev pl1" title="Deep Learning 性能测试 ">
			上一页: Deep Learning 性能测试
		</a>
		

		
		<a href="/ai/deep_learning/manual/model/" class="next pr1" title="附表1">
			下一页: 附表1
		</a>
		
	</div>
	<div class="page-meta-pagination_word">
		这篇文档解决了您的问题吗？
		<div class="doc_fix_click fix-background-like" data-flag='1'>
			<span>0</span>
		</div>
		<div class="doc_fix_click fix-background-unlike" data-flag='0'>
			<span>0</span>
		</div>
		<input type="hidden" id="doc_fix_flag" value="0">
	</div>
</div>
<script src="/js/content.js"></script>
<script src="/js/viewer.min.js"></script>
<link rel="stylesheet" href="/css/viewer.min.css">
<script>
	var viewer = new Viewer(document.querySelector('.td-content'), {
		url: 'src'
	})
</script>

          </main>
        </div>
      </div>
    </div>
         
    
<script src="/css/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
</script>






<script src="/js/main.min.7d5b92c4889cf0554b0ea5e2309b0b81b196aa7c9a235632938a25d9fc4d8a7c.js" integrity="sha256-fVuSxIic8FVLDqXiMJsLgbGWqnyaI1Yyk4ol2fxNinw=" crossorigin="anonymous"></script>



  </body>
</html>