<!doctype html>
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="generator" content="Hugo 0.101.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="icon" href="http://yiqiyun.sd.cegn.cn/static/assets/images/favicon.ico?v=1632342842" type="image/x-icon">

<title>WAF配置指南 | 亿栖云文档</title>

<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/autocomplete.css" rel="stylesheet" />
<link href="/css/copy-to-clipboard.css" rel="stylesheet" />


    



<link rel="preload" href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" as="style">
<link href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" rel="stylesheet" integrity="">


<script
  src="/js/jquery-2.2.4.js?v=1510299508"
  ></script>
	

<script src="/js/common.js?v=1.3"></script>

  </head>
  <body class="td-page">
    <header>
      <div class="nav-wrapper ">
  <nav class="navbar navmenu"  style="display:none;" >
    <div class="container with-no-position doc-container-width ">
      <div class="navbar-brand" id="search-mobile-logo">
        <a class="navbar-item logo" href="http://www.yiqiyun.net.cn">
          <img src="/images/yiqiyun_logo.png" alt="logo" style="height: 32px;width: 120px;">
        </a>
      </div>
      <div class="media-content column is-centered is-5 search-mobile">
        <form action="/search" method="GET">
          <div class="control has-icons-right docs-search-input">
            <input class="input" id="search-bar" name="q" type="search" placeholder="搜索" autocomplete="off">
            <span class="icon is-right" id="mobile-search">
              <img src="/images/icons/search.svg">
            </span>
          </div>
        </form>
        <a href="javascript:;" class="search-mobile-icon"><img src="/images/icons/search.svg"></a>
      </div>
      <div class="navbar-end is-hidden-mobile header-account">
        <div class="navbar-item">
          <div class="field is-grouped">
            <p class="control navbar-user">
              <a class="nav-item" href="http://www.yiqiyun.cn">服务商门户</a>
            </p>
            <p class="control navbar-user">
              <a class="nav-item" href="http://console.yiqiyun.cn/login">登录</a>
            </p>
            <div class="navbar-user">
              <a class="button is-primary j-signup" href="http://console.yiqiyun.cn/signup/" data-gio="{id:'createPageView',var:{sourceType_var:'导航栏'}}" style="background-color: #55a8fd">注册</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  
  <nav class="navbar navmenu navbar-index">
    <div class="container is-size-7 doc-container-width " data-path="1">


	
	
		

  
  

  
  

  
  

  


	
	




  


	
	
	<a href="/security/waf/" class="has-text-primary">Web应用防火墙</a><img class="container_span_space" src="/images/icons/path.svg">
	




  


	
	
	<a href="" class="has-text-primary">操作指南</a><img class="container_span_space" src="/images/icons/path.svg">
	




  



	
	<span class="crumb-last-color">WAF配置指南</span>
	



	

</div>


  </nav>
  
</div>
    </header>
    <div class="container td-outer doc-container-width container-min-height">
      <div class="td-main">
		
			<h1 class="console-tree-title">操作指南</h1>
		
        <div class="row flex-xl-nowrap">
		  
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none td-sidebar-menu">
            





<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2" id="td-section-nav">
    <div class="nav-item dropdown d-block ">
      
      
      













<span class="menu__title--collapse active display-hide"
  data-depth="0">
  Web应用防火墙
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/waf/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/waf/news/product_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/intro/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/waf/intro/introduction/"
      class="menu__title  "
      data-depth="1">Web应用防火墙简介</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/waf/manual/waf_user_guide/"
      class="menu__title active "
      data-depth="1">WAF配置指南</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  安全组
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/security_group/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/security_group/intro/introduction/"
      class="menu__title  "
      data-depth="1">安全组简介</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/security_group/intro/port/"
      class="menu__title  "
      data-depth="1">常用端口</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/security_group/manual/sg_create/"
      class="menu__title  "
      data-depth="1">创建安全组</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/security_group/manual/sg_setting/"
      class="menu__title  "
      data-depth="1">配置安全组</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/security_group/manual/sg_rules/"
      class="menu__title  "
      data-depth="1">添加安全组规则</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/security_group/manual/sg_subset/"
      class="menu__title  "
      data-depth="1">添加规则子集</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  网络访问控制
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/acl/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/acl/intro/introduction/"
      class="menu__title  "
      data-depth="1">网络访问控制简介</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/acl/manual/acl_manual/"
      class="menu__title  "
      data-depth="1">网络 ACL 基本操作</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/acl/manual/acl_vpc_private/"
      class="menu__title  more-space"
      data-depth="1">VPC 和私有网络 Vxnet 的网络 ACL 配置和操作</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  云防火墙 CFW
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/firewall/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/billing/price/"
      class="menu__title  "
      data-depth="1">计费指南</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/billing/buyserv/"
      class="menu__title  "
      data-depth="1">购买云防火墙服务</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/intro/intro/"
      class="menu__title  "
      data-depth="1">什么是云防火墙</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/intro/function/"
      class="menu__title  "
      data-depth="1">功能特性</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/intro/application/"
      class="menu__title  "
      data-depth="1">应用场景</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quick-start/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/quick-start/base/"
      class="menu__title  "
      data-depth="1">教程概览</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/quick-start/data/"
      class="menu__title  "
      data-depth="1">业务系统资产</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/quick-start/safety/"
      class="menu__title  "
      data-depth="1">安全策略</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  用户指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/checkdata/"
      class="menu__title  "
      data-depth="1">查看资产状态</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/cfw/"
      class="menu__title  "
      data-depth="1">访问控制策略</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/attck_protect/"
      class="menu__title  "
      data-depth="1">入侵防御策略</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/flow/"
      class="menu__title  "
      data-depth="1">流量控制策略</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/black_white_list/"
      class="menu__title  "
      data-depth="1">黑白名单</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/management/"
      class="menu__title  "
      data-depth="1">通用管理</a>
  </li>
  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  日志审计
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/logs/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/logs/logs_security/"
      class="menu__title  "
      data-depth="2">安全日志</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/logs/logs_traffic/"
      class="menu__title  "
      data-depth="2">流量日志</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/logs/logs_operations.md/"
      class="menu__title  "
      data-depth="2">操作日志</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/others/"
      class="menu__title  "
      data-depth="1">产品设置</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/security/firewall/manual/rsyslog/"
      class="menu__title  "
      data-depth="1">配置远端主机</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/security/waf/manual/waf_user_guide/>
  
  
  
  
  
  <li>
    <a href="/security/firewall/faq/faq/"
      class="menu__title  "
      data-depth="1">常见问题</a>
  </li>
  
  
</ul>


  
  
</ul>


      
    </div>
  </nav>
</div>


<script src="/js/sidebar-tree.js"></script>


          </div>
          <div class="d-none col-md-2 d-xl-block d-md-block col-xl-2 td-toc d-print-none">
            


<h3 class="nav-title">本页目录</h3>


<nav id="TableOfContents">
  <ul>
    <li><a href="#新建-waf">新建 WAF</a></li>
    <li><a href="#关闭-waf">关闭 WAF</a></li>
    <li><a href="#开启-waf">开启 WAF</a></li>
    <li><a href="#性能">性能</a></li>
  </ul>
</nav>




          </div>
          <main class="col-12 col-md-7 col-xl-7" role="main">
            
  

            
            
            
<div class="td-content">
	<div class="td-sidebar-section-title content-index">
		<img class="is-40x40" src="/images/icons/book-open.svg">
		<h3 class="doc_vice_title">操作指南</h3>
		<a href="javascript:;" class="nav-trigger">&nbsp;<span aria-hidden="true"></span></a>
	</div>
	<div class="td-page-top">
		<h1>WAF配置指南</h1>
		






<div class="td-page-meta page-meta-actions ml-2 pb-1 mb-0">







</div>



	</div>
	<div class="page-meta-lastmod text-muted ">
	更新时间 2020-12-01

</div>

	<input type="hidden" id="content_console" value="1">
	
	
	<div class="lead"></div>
	

	
	<h2 id="新建-waf">新建 WAF</h2>
<p>WAF(Web 应用防火墙) 是跟负载均衡器（LoadBalancer）一起部署的，所以新建 WAF 需要新建负载均衡器并对其配置。 WAF 的策略配置项在这里可以修改，下面会分别讲到。</p>
<p><img src="../../_images/security_tab_waf.png" alt=""></p>
<p><strong>第一步：创建一个负载均衡器</strong></p>
<p>首先，您需要创建一个负载均衡器。 在创建的对话框中点击<strong>显示高级选项</strong>，可以选择是否开启 WAF ，开启 WAF 之后会选择要求绑定一个全局配置组。
<img src="../../_images/create_waf.png" style="zoom:50%;" /></p>
<blockquote>
<p>说明</p>
<p>开启 WAF 需要额外的计算资源, 请选择最大连接数 20000 及以上的规格。</p>
</blockquote>
<p><strong>第二步：新建监听器</strong></p>
<p>当负载均衡器创建完成之后，我们需要新建一个 HTTP/HTTPS 协议的监听器。 监听器建好之后，可以给其配置 WAF 域名防护策略。</p>
<p><img src="../../_images/lb_listener_with_waf.png" alt=""></p>
<p>点击负载均衡器详情页面，选择设置的菜单栏，选择<strong>开启 web 应用防火墙</strong>，可以弹出 WAF 域名防护策略的选择页面：</p>
 <img src="../../_images/attach_null_waf_policy_to_lbl.png" style="zoom:50%;" />
<p><strong>第三步：配置 WAF 域名防护策略</strong></p>
<p>WAF 的防护是以域名为单位，可以针对指定的域名配置具体的策略， 当 WAF 收到 HTTP/HTTPS 请求时，先判断域名是否在保护列表中，命中域名则进行后续的内容检查。 一个监听器可以配置最多 100 个域名防护策略。 选择 Web 应用防火墙，在 WAF 域名防护策略组里可以新建防护策略。</p>
<p><img src="../../_images/security_tab_waf.png" alt=""></p>
  <img src="../../_images/create_waf_domain_policy.png" style="zoom:50%;" />
<blockquote>
<p><strong>说明</strong></p>
<p>云服务器域名为必填项，可使用 * 匹配所有二级域名，域名必须与后端服务器域名匹配。</p>
</blockquote>
<p>在 “行为” 一栏可以选择命中 WAF 规则时的响应动作，默认为执行规则内容，根据规则定义的动作来响应。 也可以配置为 “仅报告”，这样就是 “旁路观察” 模式，对命中规则的请求只记录日志不做阻断。</p>
<p><strong>第四步：配置 WAF 检测规则</strong></p>
<p>创建好域名防护策略之后，WAF 就会加载系统的默认检测规则，这些规则由亿栖云维护并更新：
除了基于签名的规则防护之外，也可以选择基于语法的 SQLI 和 XSS 防护，开启这两个功能之前，可以配置为只记录日志观察一段时间。</p>
<p><img src="../../_images/create_ai_sql_xss.png" alt=""></p>
<p>用户也可以根据自己 Web 应用的特点，定制 WAF 检测规则，点击自定义规则下的 “创建” 可以弹出新建窗口：</p>
 <img src="../../_images/create_waf_rule.png" style="zoom:50%;" />
<p>规则的行为可配置为观察模式或者阻断模式，观察只记录不阻断对业务系统无影响，也可以配置限速限流。</p>
<blockquote>
<p><strong>说明</strong></p>
<p>新增规则时请配置为观察模式，待规则稳定之后再修改为阻断模式。</p>
</blockquote>
 <img src="../../_images/waf_rule_detail.png" style="zoom:50%;" />
<p>规则配置要填写要检测的 HTTP 协议字段内容，当前一条规则支持配置检查 5 个协议变量，提交修改之后可以看到填写的内容。</p>
<p><img src="../../_images/waf_rule_after_create_detail.png" alt=""></p>
<p>除了可以配置自定义的规则，还可以配置自定义的黑白名单以及 CC 防护功能，点击 “黑白名单” 下的 “创建”：</p>
 <img src="../../_images/waf_ip_list.png" style="zoom:50%;" />
<blockquote>
<p><strong>说明</strong></p>
<p>配置的 IP 是将被检查的请求源 IP，包含可选的子网掩码。</p>
</blockquote>
 <img src="../../_images/waf_url_list.png" style="zoom:50%;" />
<blockquote>
<p><strong>说明</strong></p>
<p>配置的 URL 将进行路径前缀匹配，例如 /abc 可以匹配 /abc/123。</p>
</blockquote>
 <img src="../../_images/waf_cc_list.png" style="zoom:50%;" />
<blockquote>
<p><strong>说明</strong></p>
<p>配置的 URL 将进行完全匹配，这里请填写完整的 URL 路径。</p>
</blockquote>
 <img src="../../_images/waf_url_referer_list.png" style="zoom:50%;" />
<blockquote>
<p><strong>说明</strong></p>
<p>将检查 URL 的来源是否为配置的 REFERER, 不是则进行阻断。是则检查访问频率，超过阈值进行阻断。地址是前缀匹配，例如 /abc 可以匹配 /abc/123。</p>
</blockquote>
<p>配置完之后可以看到规则列表：</p>
<p><img src="../../_images/waf_cc_after_create_detail.png" alt=""></p>
<p><strong>第五步：绑定 WAF 域名防护策略</strong></p>
<p>在第三步中给监听器配置 WAF 域名防护策略时，因为还没有创建 WAF 域名策略，所以弹出的列表是空的。 现在添加 WAF 域名防护策略按钮，可以列出来已创建的域名防护策略。</p>
<p><img src="../../_images/attach_waf_dp_to_lbl.png" alt=""></p>
<p>绑定之后，在监听器下方会列出来所加载的 WAF 域名防护策略：</p>
<p><img src="../../_images/after_attach_waf_dp_to_lbl.png" alt=""></p>
<blockquote>
<p><strong>说明</strong></p>
<p>配置之后要点击负载均衡器的 “应用修改” 来更新。</p>
</blockquote>
<p>针对 WAF 操作的按钮也会单独列出来,可以在这里将 WAF 规则解绑，或者查看 WAF 的检测结果</p>
<p><strong>第六步：全局 WAF 配置组</strong></p>
<p>WAF 配置组是针对负载均衡器的全局配置，这里可以针对 WAF 功能做微调，比如配置 WAF 日志发送的地址等，可修改的选项如下：</p>
 <img src="../../_images/waf_param_detail.png" style="zoom:50%;" />
<ul>
<li><strong>logcenter_ip</strong>: WAF 的日志服务器地址，不填则不发送</li>
<li><strong>logcenter_port</strong>: WAF 的日志服务器端口</li>
<li><strong>syslog_facility</strong>: WAF 的 syslog facility</li>
<li><strong>syslog_level</strong>: WAF 的 syslog level</li>
<li><strong>event_to_local</strong>: 是否在本地记录 WAF 日志，0 不记录</li>
<li><strong>max_local_event_num</strong>: 本地记录的 WAF 的日志最大条目</li>
<li><strong>max_cc_nodes</strong>: 支持检测的 CC 节点的数量</li>
<li><strong>cc_expire_secs</strong>: CC 检测的节点超时时间</li>
<li><strong>cc_block_ratio</strong>: CC 检测的阻断惩罚速率</li>
<li><strong>cc_suspect_ratio</strong>: CC 检测的可疑惩罚速率</li>
<li><strong>max_block_ratio</strong>: 系统最大阻断率</li>
<li><strong>max_connect_check_time</strong>: 系统保活探测次数</li>
<li><strong>max_system_ratio</strong>: WAF 最大资源利用率</li>
<li><strong>module_cc_enable</strong>: 是否开启 CC 功能，0 不开启</li>
<li><strong>module_check_enable</strong>: 是否开启规则检查功能，0 不开启</li>
<li><strong>module_iplist_enable</strong>: 是否开启 IP 黑白名单功能，0 不开启</li>
<li><strong>module_urllist_enable</strong>: 是否开启 URL 黑白名单功能，0 不开启</li>
</ul>
<blockquote>
<p>注解: 配置之后要点击 “应用修改” 来更新。</p>
</blockquote>
<p><strong>第七步：查看 WAF 监控日志</strong></p>
<p>开启 WAF 之后可以查看检测的监控统计，在监听器的右边点击 WAF 的按钮选择 “监控”：</p>
 <img src="../../_images/lbl_waf_monitor_switch.png" style="zoom:50%;" />
<p><img src="../../_images/lbl_waf_event_monitor.png" alt=""></p>
<p>这里是针对每个监听器，按命中的规则和黑白名单来分别统计。</p>
<p>也可以查看整个负载均衡的监控情况，点击 “WAF监控” 选择 “监控”:</p>
 <img src="../../_images/lb_waf_monitor.png" style="zoom:50%;" />
<p>点击 “WAF监控” 选择 “日志” 可以查看本地保存的攻击日志。</p>
<blockquote>
<p><strong>说明</strong></p>
<p>本地日志默认保存 2000 条，要保存更多日志可以配置 WAF 的日志服务器，WAF 的检测日志可以通过 syslog 的方式发送出去。</p>
</blockquote>
<p>WAF 的日志可以通过syslog的格式发送到日志服务器，可以修改配置组中的 <strong>logcenter_ip</strong> 和 <strong>logcenter_port</strong> 参数来配置。 同时，可以将日志倒入 ELK 来分析处理，需要使用 <strong>logstash-input-syslog</strong> 来接收syslog日志，并配置 grok 过滤参数如下：</p>
<pre tabindex="0"><code> grok {
 match =&gt; { “message” =&gt; “%{WORD:method} %{HOSTNAME:domain} %{URIPATHPARAM:url} %{NOTSPACE:client_ip} %{WORD:action} %{INT:impact} %{WORD:module} %{NOTSPACE:attack_type} %{NOTSPACE:rule_id} %{NOTSPACE:ua} %{GREEDYDATA:post}” }
 }
</code></pre><p>可配置的 dashboard 效果如下：</p>
<p><img src="../../_images/waf_dashboard.png" alt=""></p>
<h2 id="关闭-waf">关闭 WAF</h2>
<p>进入负载均衡器页面，设置的菜单栏里可以看到 “禁用 Web 应用防火墙” 的选项。</p>
<p><img src="../../_images/lbl_waf_monitor_switch1.png" alt=""></p>
<blockquote>
<p><strong>说明</strong></p>
<p>配置之后要点击负载均衡器的 “应用修改” 来更新。</p>
</blockquote>
<h2 id="开启-waf">开启 WAF</h2>
<p>给已经创建好的负载均衡器开启 WAF 功能时，右键点击负载均衡器，可以看到 “开启 Web 应用防火墙” 的选项：</p>
<p><img src="../../_images/start_wafpg.png" alt=""></p>
<p>弹出让我们选择 WAF 配置组的选项：</p>
<p><img src="../../_images/attach_waf_dp_to_lbl.png" alt=""></p>
<p>如果当前负载均衡器的版本太低，会提示进行升级，需要先关闭然后再开启负载均衡器。</p>
<p>开启 WAF 功能之后，需要给监听器绑定域名防护策略，步骤同上。</p>
<blockquote>
<p>说明</p>
<p>配置之后要点击负载均衡器的 “应用修改” 来更新。</p>
</blockquote>
<h2 id="性能">性能</h2>
<p>WAF 需要做规则匹配，所以需要更多的 CPU 处理时间和内存，QPS 也有少许下降：</p>
<ul>
<li><strong>CPU</strong>: 根据规则数量和请求的不同 CPU 的使用率有 2% - 30% 的升高</li>
<li><strong>内存</strong>: 根据规则数量和请求的不同需要 128M 以上的内存</li>
<li><strong>QPS</strong>: 根据规则数量和请求的不同 QPS 有 4% - 10% 的下降</li>
</ul>
<blockquote>
<p><strong>说明</strong></p>
<p>该数据仅供参考，可根据自己的业务系统做测试来获得第一手资料。</p>
</blockquote>

	
	
	<div class="page-meta-pagination border-top">
		

		
	</div>
	<div class="page-meta-pagination_word">
		这篇文档解决了您的问题吗？
		<div class="doc_fix_click fix-background-like" data-flag='1'>
			<span>0</span>
		</div>
		<div class="doc_fix_click fix-background-unlike" data-flag='0'>
			<span>0</span>
		</div>
		<input type="hidden" id="doc_fix_flag" value="0">
	</div>
</div>
<script src="/js/content.js"></script>
<script src="/js/viewer.min.js"></script>
<link rel="stylesheet" href="/css/viewer.min.css">
<script>
	var viewer = new Viewer(document.querySelector('.td-content'), {
		url: 'src'
	})
</script>

          </main>
        </div>
      </div>
    </div>
         
    
<script src="/css/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
</script>






<script src="/js/main.min.7d5b92c4889cf0554b0ea5e2309b0b81b196aa7c9a235632938a25d9fc4d8a7c.js" integrity="sha256-fVuSxIic8FVLDqXiMJsLgbGWqnyaI1Yyk4ol2fxNinw=" crossorigin="anonymous"></script>



  </body>
</html>