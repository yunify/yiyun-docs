<!doctype html>
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="generator" content="Hugo 0.101.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="icon" href="http://yiqiyun.sd.cegn.cn/static/assets/images/favicon.ico?v=1632342842" type="image/x-icon">

<title>strongswan与VPC共同搭建隧道 | 亿栖云文档</title>

<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/autocomplete.css" rel="stylesheet" />
<link href="/css/copy-to-clipboard.css" rel="stylesheet" />


    



<link rel="preload" href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" as="style">
<link href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" rel="stylesheet" integrity="">


<script
  src="/js/jquery-2.2.4.js?v=1510299508"
  ></script>
	

<script src="/js/common.js?v=1.3"></script>

  </head>
  <body class="td-page">
    <header>
      <div class="nav-wrapper ">
  <nav class="navbar navmenu"  style="display:none;" >
    <div class="container with-no-position doc-container-width ">
      <div class="navbar-brand" id="search-mobile-logo">
        <a class="navbar-item logo" href="http://www.yiqiyun.net.cn">
          <img src="/images/yiqiyun_logo.png" alt="logo" style="height: 32px;width: 120px;">
        </a>
      </div>
      <div class="media-content column is-centered is-5 search-mobile">
        <form action="/search" method="GET">
          <div class="control has-icons-right docs-search-input">
            <input class="input" id="search-bar" name="q" type="search" placeholder="搜索" autocomplete="off">
            <span class="icon is-right" id="mobile-search">
              <img src="/images/icons/search.svg">
            </span>
          </div>
        </form>
        <a href="javascript:;" class="search-mobile-icon"><img src="/images/icons/search.svg"></a>
      </div>
      <div class="navbar-end is-hidden-mobile header-account">
        <div class="navbar-item">
          <div class="field is-grouped">
            <p class="control navbar-user">
              <a class="nav-item" href="http://www.yiqiyun.cn">服务商门户</a>
            </p>
            <p class="control navbar-user">
              <a class="nav-item" href="http://console.yiqiyun.cn/login">登录</a>
            </p>
            <div class="navbar-user">
              <a class="button is-primary j-signup" href="http://console.yiqiyun.cn/signup/" data-gio="{id:'createPageView',var:{sourceType_var:'导航栏'}}" style="background-color: #55a8fd">注册</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  
  <nav class="navbar navmenu navbar-index">
    <div class="container is-size-7 doc-container-width " data-path="1">


	
	
		

  
  

  
  

  
  

  


	
	




  


	
	
	<a href="/network/vpc/" class="has-text-primary">VPC 网络</a><img class="container_span_space" src="/images/icons/path.svg">
	




  


	
	
	<a href="" class="has-text-primary">最佳实践</a><img class="container_span_space" src="/images/icons/path.svg">
	




  



	
	<span class="crumb-last-color">详情</span>
	



	

</div>


  </nav>
  
</div>
    </header>
    <div class="container td-outer doc-container-width container-min-height">
      <div class="td-main">
		
			<h1 class="console-tree-title">最佳实践</h1>
		
        <div class="row flex-xl-nowrap">
		  
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none td-sidebar-menu">
            





<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2" id="td-section-nav">
    <div class="nav-item dropdown d-block ">
      
      
      













<span class="menu__title--collapse active display-hide"
  data-depth="0">
  VPC 网络
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/vpc/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/intro/10_intro/"
      class="menu__title  "
      data-depth="1">VPC 网络简介</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/billing/price/"
      class="menu__title  "
      data-depth="1">VPC 网络计费</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quick-start/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/quick-start/10_qs_net_plan/"
      class="menu__title  "
      data-depth="1">网络规划</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/quick-start/20_qs_ipv4/"
      class="menu__title  "
      data-depth="1">搭建 IPv4 VPC 网络</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/manual/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  VPC网络
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/vpcnet/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/10_create_vpc/"
      class="menu__title  "
      data-depth="2">创建 VPC 网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/15_bind_vxnet/"
      class="menu__title  "
      data-depth="2">连接私有网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/20_modify_vpc/"
      class="menu__title  "
      data-depth="2">修改 VPC 基本信息</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/25_mdy_type/"
      class="menu__title  "
      data-depth="2">修改 VPC 规格类型</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/26_bind_eip/"
      class="menu__title  "
      data-depth="2">绑定公网 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/35_del_vpc/"
      class="menu__title  "
      data-depth="2">删除 VPC 网络</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  私有网络
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/vxnet/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/05_create_vxnet/"
      class="menu__title  "
      data-depth="2">创建私有网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/08_addto_vpc/"
      class="menu__title  "
      data-depth="2">加入 VPC 网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/10_mdfy_vxnet/"
      class="menu__title  "
      data-depth="2">修改私有网络基本信息</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/20_add_resource/"
      class="menu__title  "
      data-depth="2">在私有网络中创建资源</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/25_bind_acl/"
      class="menu__title  "
      data-depth="2">绑定网络 ACL</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/30_bind_route/"
      class="menu__title  "
      data-depth="2">绑定路由表</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/31_leave_vpc/"
      class="menu__title  "
      data-depth="2">离开 VPC 网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/32_del_vxnet/"
      class="menu__title  "
      data-depth="2">删除私有网络</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/30_fig_manage/"
      class="menu__title  "
      data-depth="1">图形化操作</a>
  </li>
  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  隧道服务
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/tunnel/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/tunnel/gre/"
      class="menu__title  "
      data-depth="2">GRE 隧道</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/tunnel/ipsec/"
      class="menu__title  "
      data-depth="2">IPsec 隧道</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpn/"
      class="menu__title  "
      data-depth="1">VPN 服务</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/route_table/"
      class="menu__title  "
      data-depth="1">使用路由表</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/virtual_ip/"
      class="menu__title  "
      data-depth="1">使用虚拟 IP </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/span/"
      class="menu__title  "
      data-depth="1">管理网络流量镜像</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpc_acl/"
      class="menu__title  "
      data-depth="1">网关过滤控制(ACL)</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  最佳实践
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/best-practices/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/"
      class="menu__title active "
      data-depth="1">strongswan与VPC共同搭建隧道</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/best-practices/win_multi_vpcs/"
      class="menu__title  more-space"
      data-depth="1">Windows客户端拨入VPN实现跨多个VPC之间的内网互通</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/how_to_configure_pptp_vpn_for_windows_host/"
      class="menu__title  "
      data-depth="1">Windows 云服务器中配置PPTP VPN</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/how_to_use_public_network_dns_forwarding/"
      class="menu__title  "
      data-depth="1">公网 DNS 转发如何使用</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/vpc_faq/"
      class="menu__title  "
      data-depth="1">何种情况下需要手动配置网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/network_between_vms/"
      class="menu__title  "
      data-depth="1">VPC中云服务器之间网络不通</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_dns_push/"
      class="menu__title  more-space"
      data-depth="1">OpenVPN 客户端启用服务端推送的 DNS 配置</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_add_virtual_network_adapter/"
      class="menu__title  "
      data-depth="1">OpenVPN添加虚拟网卡</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/methods_of_port_forwarding/"
      class="menu__title  "
      data-depth="1">使用端口转发功能</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/intranet_dns_guide/"
      class="menu__title  "
      data-depth="1">使用内网DNS功能</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_building_linux/"
      class="menu__title  "
      data-depth="1">在Linux客户端中配置OpenVPN</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_building/"
      class="menu__title  "
      data-depth="1">在Windows客户端中配置OpenVPN</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/ptr/"
      class="menu__title  "
      data-depth="1">关闭/开启 PTR</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/iso_l2tp/"
      class="menu__title  "
      data-depth="1">IOS 客户端如何连接L2TP-IPsecVPN？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/mac_openvpn_client/"
      class="menu__title  "
      data-depth="1">OpenVPN Mac 客户端使用方法</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  NAT 网关
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/nat_gateway/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/intro/nat_gateway/"
      class="menu__title  "
      data-depth="1">NAT 网关简介</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/intro/net_quota/"
      class="menu__title  "
      data-depth="1">绑定私有网络限制</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/manual/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/manual/nat_user_guide/"
      class="menu__title  "
      data-depth="1">操作指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  最佳实践
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/best-practices/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/best-practices/nat_and_vpc/"
      class="menu__title  "
      data-depth="1">NAT 网关配合 VPC 使用</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  公网 IP
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/eip/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/intro/introduction/"
      class="menu__title  "
      data-depth="1">什么是公网 IP</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/billing/price/"
      class="menu__title  "
      data-depth="1">计费指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quickstart/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/quickstart/ipv6_quick_start/"
      class="menu__title  "
      data-depth="1">搭建 IPv6 网络并开通公网访问</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/manual/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  绑定 IPv4 公网 IP
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/ipv4/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv4/outband_ipv4/"
      class="menu__title  "
      data-depth="2">外部绑定公网 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv4/inband_ipv4/"
      class="menu__title  "
      data-depth="2">内部绑定公网 IP</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  绑定 IPv6 公网 IP
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/ipv6/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv6/outband_ipv6/"
      class="menu__title  "
      data-depth="2">外部绑定公网 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv6/inband_ipv6/"
      class="menu__title  "
      data-depth="2">内部绑定公网 IP</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv6_auto_config/"
      class="menu__title  "
      data-depth="1">开启云服务器 IPv6 自动化配置</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/eip/faq/high_ping/"
      class="menu__title  "
      data-depth="1">公网IP网络延迟增大</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/faq/faq/"
      class="menu__title  "
      data-depth="1">连接问题</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/faq/bill_faq/"
      class="menu__title  "
      data-depth="1">费用问题</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  负载均衡
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/loadbalancer/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/intro/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/introduction/"
      class="menu__title  "
      data-depth="1">什么是负载均衡</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/advantage/"
      class="menu__title  "
      data-depth="1">产品特性</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/senario/"
      class="menu__title  "
      data-depth="1">应用场景</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/limit/"
      class="menu__title  "
      data-depth="1">产品限制</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/billing/price/"
      class="menu__title  "
      data-depth="1">计费指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quickstart/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/quickstart/quick_start/"
      class="menu__title  "
      data-depth="1">快速入门</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/manual/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/manual/lb_user_guide/"
      class="menu__title  "
      data-depth="1">操作指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  最佳实践
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/best-practices/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/best-practices/lb_natgw/"
      class="menu__title  "
      data-depth="1">搭建跨越公网的负载均衡</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/after_end_miss/"
      class="menu__title  "
      data-depth="1">负载均衡后端不可用排查方法</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_502_503_504/"
      class="menu__title  more-space"
      data-depth="1">访问负载均衡器返回502/503/504是什么原因</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_bind_multi_cert/"
      class="menu__title  "
      data-depth="1">负载均衡器如何支持多证书</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/http2_enabled_does_not_take_effect/"
      class="menu__title  "
      data-depth="1">开启 HTTP2 不生效</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_check_session_hold/"
      class="menu__title  more-space"
      data-depth="1">如何检查负载均衡器会话保持是否生效</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_turn_on_http2/"
      class="menu__title  "
      data-depth="1">如何开启 HTTP2</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_session_hold/"
      class="menu__title  "
      data-depth="1">LB 会话保持</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/haproxy_log/"
      class="menu__title  "
      data-depth="1">rsyslog 日志分析</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_faq/"
      class="menu__title  "
      data-depth="1">常见问题</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_get_real_ip/"
      class="menu__title  "
      data-depth="1">获取来访者的真实 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_long_connection/"
      class="menu__title  "
      data-depth="1">开启长连接</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/http_check_failed/"
      class="menu__title  "
      data-depth="1">七层(HTTP/HTTPS)健康检查异常</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/tcp_check_fialed/"
      class="menu__title  "
      data-depth="1">四层（TCP/UDP）健康检查出现异常	</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/connection_peer/"
      class="menu__title  more-space"
      data-depth="1">业务日志中出现“Connection reset by peer”的错误</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  边界路由器
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/border_router/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/border_router/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/border_router/intro/border_router/"
      class="menu__title  "
      data-depth="1">边界路由器</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/manual/ data-link=/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/>
  
  
  
  
  
  <li>
    <a href="/network/border_router/manual/border_user_guide/"
      class="menu__title  "
      data-depth="1">操作指南</a>
  </li>
  
  
</ul>


  
  
</ul>


      
    </div>
  </nav>
</div>


<script src="/js/sidebar-tree.js"></script>


          </div>
          <div class="d-none col-md-2 d-xl-block d-md-block col-xl-2 td-toc d-print-none">
            


<h3 class="nav-title">本页目录</h3>


<nav id="TableOfContents">
  <ul>
    <li><a href="#项目介绍">项目介绍</a>
      <ul>
        <li><a href="#jn1-vpc自身具备ipsec服务">jn1 （vpc自身具备ipsec服务）</a></li>
        <li><a href="#jn2--vm信息模拟本地idc机房服务器">jn2  vm信息（模拟本地IDC机房服务器）</a></li>
        <li><a href="#最终需要实现">最终需要实现</a></li>
        <li><a href="#1jn2区的vm需要安装strongswan-采用以下命令">1、jn2区的vm需要安装strongswan ，采用以下命令</a></li>
        <li><a href="#2配置内核参数">2、配置内核参数</a></li>
        <li><a href="#3生成预共享秘钥">3、生成预共享秘钥</a></li>
        <li><a href="#4jn2-vm的隧道环境配置参数">4、jn2 vm的隧道环境配置参数</a></li>
        <li><a href="#5jn1-vpc的环境配置vpc自身具备ipsec服务">5、jn1 vpc的环境配置（vpc自身具备ipsec服务）</a></li>
        <li><a href="#6启动strongswan服务">6、启动strongswan服务</a></li>
        <li><a href="#7查看服务端口监听">7、查看服务端口监听</a></li>
        <li><a href="#8启动ipsec服务并查看隧道连接状态">8、启动ipsec服务，并查看隧道连接状态</a></li>
        <li><a href="#9测试网络是否联通">9、测试网络是否联通</a></li>
      </ul>
    </li>
  </ul>
</nav>




          </div>
          <main class="col-12 col-md-7 col-xl-7" role="main">
            
  

            
            
            
<div class="td-content">
	<div class="td-sidebar-section-title content-index">
		<img class="is-40x40" src="/images/icons/book-open.svg">
		<h3 class="doc_vice_title">最佳实践</h3>
		<a href="javascript:;" class="nav-trigger">&nbsp;<span aria-hidden="true"></span></a>
	</div>
	<div class="td-page-top">
		<h1>strongswan与VPC共同搭建隧道</h1>
		






<div class="td-page-meta page-meta-actions ml-2 pb-1 mb-0">







</div>



	</div>
	<div class="page-meta-lastmod text-muted ">
	更新时间 2020-12-01

</div>

	<input type="hidden" id="content_console" value="1">
	
	
	
	

	
	<h2 id="项目介绍">项目介绍</h2>
<p>客户业务在往计算平台迁移的过程中，因为两边的数据需要同步，所以需要建立站点到站点ipsec隧道，由于本地IDC设备不支持vpn服务，所以采用自建ipsec的方式互联，采用的是strongswan的方式，以下是模拟客户业务环境，成功搭建ipsec隧道的案例，供参考。</p>
<h3 id="jn1-vpc自身具备ipsec服务">jn1 （vpc自身具备ipsec服务）</h3>
<p>私有网络  172.25.100.0/24</p>
<p>公网ip     139.198.120.221</p>
<h3 id="jn2--vm信息模拟本地idc机房服务器">jn2  vm信息（模拟本地IDC机房服务器）</h3>
<p>私有ip  172.20.100.180</p>
<p>公网ip   139.198.13.15</p>
<p>私有网络 172.20.100.0/24</p>
<h3 id="最终需要实现">最终需要实现</h3>
<p>172.25.100.0/24&lt;==&gt;172.20.100.0/24</p>
<h3 id="1jn2区的vm需要安装strongswan-采用以下命令">1、jn2区的vm需要安装strongswan ，采用以下命令</h3>
<pre tabindex="0"><code>sudo apt update
sudo apt install strongswan strongswan-pki
</code></pre><h3 id="2配置内核参数">2、配置内核参数</h3>
<pre tabindex="0"><code>$ cat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF
echo net.ipv4.ip_forward = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
EOF
 
$ sysctl -p /etc/sysctl.conf
</code></pre><h3 id="3生成预共享秘钥">3、生成预共享秘钥</h3>
<pre tabindex="0"><code>root@i-y862i3l9:~# openssl rand -base64 16
oCTYi71l0ZU7WcRgLYaspg==
</code></pre><h3 id="4jn2-vm的隧道环境配置参数">4、jn2 vm的隧道环境配置参数</h3>
<h4 id="1配置预共享秘钥">1、配置预共享秘钥</h4>
<pre tabindex="0"><code>root@i-y862i3l9:~# cat /etc/ipsec.secrets
# This file holds shared secrets or RSA private keys for authentication.
 
# RSA private key for this host, authenticating it to any other host
# which knows the public part.
#本地公网出口IP   #对端公网出口IP     #双方约定的秘钥
139.198.121.220 139.198.13.15 : PSK &#34;oCTYi71l0ZU7WcRgLYaspg==&#34;
</code></pre><h4 id="2配置-ipsecconf的配置">2、配置 ipsec.conf的配置</h4>
<pre tabindex="0"><code># defined by qiyiyun
 
version 2.0
include /etc/ipsec.d/*.conf
 
config setup
    cachecrls=yes
    strictcrlpolicy=yes   
    plutostderrlog=/var/log/ipsec.log
     
conn %default
    rekey=yes
    authby=secret
    auto=start
    type=tunnel
    keyexchange=ikev1
    pfs=no
    dpddelay=15
    dpdtimeout=60
    dpdaction=restart
    #nat_traversal=yes
 
conn tojn1
    authby=secret
    left=172.20.100.180
    leftid=139.198.13.15
    leftsubnet=172.20.100.0/24
    right=139.198.121.220
    rightsubnet=172.25.100.0/24
    ike=3des-md5-modp1536!
    esp=3des-md5-modp1536!
    ikelifetime=1h
    lifetime=8h
    auto=start
 
可以参考官方文档的配置
https://www.strongswan.org/testing/testresults/ikev2/net2net-cert/moon.ipsec.conf
</code></pre><h3 id="5jn1-vpc的环境配置vpc自身具备ipsec服务">5、jn1 vpc的环境配置（vpc自身具备ipsec服务）</h3>
<img src="../homer/strongswan_01.png" width="60%" height="100%">
<p>ipsec.conf的配置如下</p>
<pre tabindex="0"><code># defined by yiqiyun
 
version 2.0
include /etc/ipsec.d/*.conf
 
config setup
    listen=10.160.1.49
    protostack=netkey
    nat_traversal=yes
    keep_alive=60
    virtual_private=
    oe=off
    # debug
    #plutodebug=&#34;all&#34;
    # log
    #plutoopts=&#34;--perpeerlog&#34;
    #plutostderrlog=/var/log/ipsec.log
     
conn %default
    rekey=yes
    authby=secret
    auto=start
    type=tunnel
    keyexchange=ike
    phase2=esp
    pfs=yes
    dpddelay=15
    dpdtimeout=60
    dpdaction=restart
 
 
conn 139.198.13.15
    left=10.160.1.49
    leftid=139.198.121.220
    leftsubnets={172.25.10.0/24}
    right=139.198.13.15
    rightid=139.198.13.15
    rightsubnets={172.20.100.0/24}
    ike=3des-md5;modp1536
    phase2alg=3des-md5;modp1536
    pfs=no
    ikev2=no
</code></pre><h3 id="6启动strongswan服务">6、启动strongswan服务</h3>
<pre tabindex="0"><code>systemctl start strongswan
systemctl enable strongswan
</code></pre><h3 id="7查看服务端口监听">7、查看服务端口监听</h3>
<pre tabindex="0"><code>
root@i-y862i3l9:~# netstat -unptl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name   
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      660/systemd-resolve
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      745/sshd           
tcp        0      0 127.0.0.1:6010          0.0.0.0:*               LISTEN      12290/sshd: root@pt
tcp6       0      0 :::22                   :::*                    LISTEN      745/sshd           
tcp6       0      0 ::1:6010                :::*                    LISTEN      12290/sshd: root@pt
udp        0      0 127.0.0.53:53           0.0.0.0:*                           660/systemd-resolve
udp        0      0 0.0.0.0:68              0.0.0.0:*                           683/dhclient       
udp        0      0 0.0.0.0:4500            0.0.0.0:*                           25435/charon       
udp        0      0 0.0.0.0:500             0.0.0.0:*                           25435/charon       
udp6       0      0 :::4500                 :::*                                25435/charon       
udp6       0      0 :::500                  :::*                                25435/charon       
root@i-y862i3l9:~#
</code></pre><h3 id="8启动ipsec服务并查看隧道连接状态">8、启动ipsec服务，并查看隧道连接状态</h3>
<pre tabindex="0"><code>root@i-y862i3l9:~# ipsec start
root@i-y862i3l9:~# ipsec statusall
Status of IKE charon daemon (strongSwan 5.6.2, Linux 4.15.0-121-generic, x86_64):
  uptime: 15 seconds, since Dec 24 12:40:48 2020
  malloc: sbrk 1626112, mmap 0, used 574896, free 1051216
  worker threads: 11 of 16 idle, 5/0/0/0 working, job queue: 0/0/0/0, scheduled: 4
  loaded plugins: charon aes rc2 sha2 sha1 md4 md5 mgf1 random nonce x509 revocation constraints pubkey pkcs1 pkcs7 pkcs8 pkcs12 pgp dnskey sshkey pem openssl fips-prf gmp agent xcbc hmac gcm attr kernel-netlink resolve socket-default connmark stroke updown eap-mschapv2 xauth-generic counters
Listening IP addresses:
  172.20.100.180
Connections:
      toap2a:  172.20.100.180...139.198.121.220  IKEv1, dpddelay=15s
      toap2a:   local:  [139.198.13.15] uses pre-shared key authentication
      toap2a:   remote: [139.198.121.220] uses pre-shared key authentication
      toap2a:   child:  172.20.100.0/24 === 172.25.100.0/24 TUNNEL, dpdaction=restart
Security Associations (1 up, 0 connecting):
      toap2a[1]: ESTABLISHED 15 seconds ago, 172.20.100.180[139.198.13.15]...139.198.121.220[139.198.121.220]
      toap2a[1]: IKEv1 SPIs: 1e2e0d6dd9f2eab1_i* ea820e636b879f8d_r, pre-shared key reauthentication in 47 minutes
      toap2a[1]: IKE proposal: 3DES_CBC/HMAC_MD5_96/PRF_HMAC_MD5/MODP_1536
      toap2a{1}:  INSTALLED, TUNNEL, reqid 1, ESP in UDP SPIs: c79efaad_i 600f945e_o
      toap2a{1}:  3DES_CBC/HMAC_MD5_96/MODP_1536, 0 bytes_i, 0 bytes_o, rekeying in 7 hours
      toap2a{1}:   172.20.100.0/24 === 172.25.100.0/24
</code></pre><h3 id="9测试网络是否联通">9、测试网络是否联通</h3>
<pre tabindex="0"><code>root@i-y862i3l9:~# ping 172.25.100.2
PING 172.25.100.2 (172.25.100.2) 56(84) bytes of data.
64 bytes from 172.25.100.2: icmp_seq=1 ttl=62 time=37.7 ms
64 bytes from 172.25.100.2: icmp_seq=2 ttl=62 time=37.8 ms
64 bytes from 172.25.100.2: icmp_seq=3 ttl=62 time=37.8 ms
64 bytes from 172.25.100.2: icmp_seq=4 ttl=62 time=37.8 ms
64 bytes from 172.25.100.2: icmp_seq=5 ttl=62 time=37.7 ms
^C
--- 172.25.100.2 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4003ms
rtt min/avg/max/mdev = 37.773/37.812/37.883/0.249 ms
root@i-y862i3l9:~# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:9e:f1:33:76 brd ff:ff:ff:ff:ff:ff
    inet 172.20.100.180/24 brd 172.20.100.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:9eff:fef1:3376/64 scope link
       valid_lft forever preferred_lft forever
root@i-y862i3l9:~#
</code></pre>
	
	
	<div class="page-meta-pagination border-top">
		

		
		<a href="/network/vpc/best-practices/win_multi_vpcs/" class="next pr1" title="Windows客户端拨入VPN实现跨多个VPC之间的内网互通">
			下一页: Windows客户端拨入VPN实现跨多个VPC之间的内网互通
		</a>
		
	</div>
	<div class="page-meta-pagination_word">
		这篇文档解决了您的问题吗？
		<div class="doc_fix_click fix-background-like" data-flag='1'>
			<span>0</span>
		</div>
		<div class="doc_fix_click fix-background-unlike" data-flag='0'>
			<span>0</span>
		</div>
		<input type="hidden" id="doc_fix_flag" value="0">
	</div>
</div>
<script src="/js/content.js"></script>
<script src="/js/viewer.min.js"></script>
<link rel="stylesheet" href="/css/viewer.min.css">
<script>
	var viewer = new Viewer(document.querySelector('.td-content'), {
		url: 'src'
	})
</script>

          </main>
        </div>
      </div>
    </div>
         
    
<script src="/css/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
</script>






<script src="/js/main.min.7d5b92c4889cf0554b0ea5e2309b0b81b196aa7c9a235632938a25d9fc4d8a7c.js" integrity="sha256-fVuSxIic8FVLDqXiMJsLgbGWqnyaI1Yyk4ol2fxNinw=" crossorigin="anonymous"></script>



  </body>
</html>