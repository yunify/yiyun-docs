<!doctype html>
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="generator" content="Hugo 0.101.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="icon" href="http://yiqiyun.sd.cegn.cn/static/assets/images/favicon.ico?v=1632342842" type="image/x-icon">

<title>VPN 服务 | 亿栖云文档</title>

<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/autocomplete.css" rel="stylesheet" />
<link href="/css/copy-to-clipboard.css" rel="stylesheet" />


    



<link rel="preload" href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" as="style">
<link href="/scss/console.min.3968935d0a1c8815d0609e047c8c7bddc7781a37538ed1b0cc049f82a7c994c1.css" rel="stylesheet" integrity="">


<script
  src="/js/jquery-2.2.4.js?v=1510299508"
  ></script>
	

<script src="/js/common.js?v=1.3"></script>

  </head>
  <body class="td-page">
    <header>
      <div class="nav-wrapper ">
  <nav class="navbar navmenu"  style="display:none;" >
    <div class="container with-no-position doc-container-width ">
      <div class="navbar-brand" id="search-mobile-logo">
        <a class="navbar-item logo" href="http://www.yiqiyun.net.cn">
          <img src="/images/yiqiyun_logo.png" alt="logo" style="height: 32px;width: 120px;">
        </a>
      </div>
      <div class="media-content column is-centered is-5 search-mobile">
        <form action="/search" method="GET">
          <div class="control has-icons-right docs-search-input">
            <input class="input" id="search-bar" name="q" type="search" placeholder="搜索" autocomplete="off">
            <span class="icon is-right" id="mobile-search">
              <img src="/images/icons/search.svg">
            </span>
          </div>
        </form>
        <a href="javascript:;" class="search-mobile-icon"><img src="/images/icons/search.svg"></a>
      </div>
      <div class="navbar-end is-hidden-mobile header-account">
        <div class="navbar-item">
          <div class="field is-grouped">
            <p class="control navbar-user">
              <a class="nav-item" href="http://www.yiqiyun.cn">服务商门户</a>
            </p>
            <p class="control navbar-user">
              <a class="nav-item" href="http://console.yiqiyun.cn/login">登录</a>
            </p>
            <div class="navbar-user">
              <a class="button is-primary j-signup" href="http://console.yiqiyun.cn/signup/" data-gio="{id:'createPageView',var:{sourceType_var:'导航栏'}}" style="background-color: #55a8fd">注册</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  
  <nav class="navbar navmenu navbar-index">
    <div class="container is-size-7 doc-container-width " data-path="1">


	
	
		

  
  

  
  

  
  

  


	
	




  


	
	
	<a href="/network/vpc/" class="has-text-primary">VPC 网络</a><img class="container_span_space" src="/images/icons/path.svg">
	




  


	
	
	<a href="" class="has-text-primary">操作指南</a><img class="container_span_space" src="/images/icons/path.svg">
	




  



	
	<span class="crumb-last-color">VPN 服务</span>
	



	

</div>


  </nav>
  
</div>
    </header>
    <div class="container td-outer doc-container-width container-min-height">
      <div class="td-main">
		
			<h1 class="console-tree-title">操作指南</h1>
		
        <div class="row flex-xl-nowrap">
		  
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none td-sidebar-menu">
            





<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2" id="td-section-nav">
    <div class="nav-item dropdown d-block ">
      
      
      













<span class="menu__title--collapse active display-hide"
  data-depth="0">
  VPC 网络
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/vpc/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/intro/10_intro/"
      class="menu__title  "
      data-depth="1">VPC 网络简介</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/billing/price/"
      class="menu__title  "
      data-depth="1">VPC 网络计费</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quick-start/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/quick-start/10_qs_net_plan/"
      class="menu__title  "
      data-depth="1">网络规划</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/quick-start/20_qs_ipv4/"
      class="menu__title  "
      data-depth="1">搭建 IPv4 VPC 网络</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  VPC网络
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/vpcnet/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/10_create_vpc/"
      class="menu__title  "
      data-depth="2">创建 VPC 网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/15_bind_vxnet/"
      class="menu__title  "
      data-depth="2">连接私有网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/20_modify_vpc/"
      class="menu__title  "
      data-depth="2">修改 VPC 基本信息</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/25_mdy_type/"
      class="menu__title  "
      data-depth="2">修改 VPC 规格类型</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/26_bind_eip/"
      class="menu__title  "
      data-depth="2">绑定公网 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpcnet/35_del_vpc/"
      class="menu__title  "
      data-depth="2">删除 VPC 网络</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  私有网络
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/vxnet/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/05_create_vxnet/"
      class="menu__title  "
      data-depth="2">创建私有网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/08_addto_vpc/"
      class="menu__title  "
      data-depth="2">加入 VPC 网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/10_mdfy_vxnet/"
      class="menu__title  "
      data-depth="2">修改私有网络基本信息</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/20_add_resource/"
      class="menu__title  "
      data-depth="2">在私有网络中创建资源</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/25_bind_acl/"
      class="menu__title  "
      data-depth="2">绑定网络 ACL</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/30_bind_route/"
      class="menu__title  "
      data-depth="2">绑定路由表</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/31_leave_vpc/"
      class="menu__title  "
      data-depth="2">离开 VPC 网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vxnet/32_del_vxnet/"
      class="menu__title  "
      data-depth="2">删除私有网络</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/30_fig_manage/"
      class="menu__title  "
      data-depth="1">图形化操作</a>
  </li>
  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  隧道服务
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/tunnel/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/tunnel/gre/"
      class="menu__title  "
      data-depth="2">GRE 隧道</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/tunnel/ipsec/"
      class="menu__title  "
      data-depth="2">IPsec 隧道</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpn/"
      class="menu__title active "
      data-depth="1">VPN 服务</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/route_table/"
      class="menu__title  "
      data-depth="1">使用路由表</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/virtual_ip/"
      class="menu__title  "
      data-depth="1">使用虚拟 IP </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/span/"
      class="menu__title  "
      data-depth="1">管理网络流量镜像</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/manual/vpc_acl/"
      class="menu__title  "
      data-depth="1">网关过滤控制(ACL)</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  最佳实践
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/best-practices/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/best-practices/building_tunnel_with_strongswan_and_vpc/"
      class="menu__title  "
      data-depth="1">strongswan与VPC共同搭建隧道</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/best-practices/win_multi_vpcs/"
      class="menu__title  more-space"
      data-depth="1">Windows客户端拨入VPN实现跨多个VPC之间的内网互通</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/how_to_configure_pptp_vpn_for_windows_host/"
      class="menu__title  "
      data-depth="1">Windows 云服务器中配置PPTP VPN</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/how_to_use_public_network_dns_forwarding/"
      class="menu__title  "
      data-depth="1">公网 DNS 转发如何使用</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/vpc_faq/"
      class="menu__title  "
      data-depth="1">何种情况下需要手动配置网络</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/network_between_vms/"
      class="menu__title  "
      data-depth="1">VPC中云服务器之间网络不通</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_dns_push/"
      class="menu__title  more-space"
      data-depth="1">OpenVPN 客户端启用服务端推送的 DNS 配置</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_add_virtual_network_adapter/"
      class="menu__title  "
      data-depth="1">OpenVPN添加虚拟网卡</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/methods_of_port_forwarding/"
      class="menu__title  "
      data-depth="1">使用端口转发功能</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/intranet_dns_guide/"
      class="menu__title  "
      data-depth="1">使用内网DNS功能</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_building_linux/"
      class="menu__title  "
      data-depth="1">在Linux客户端中配置OpenVPN</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/openvpn_building/"
      class="menu__title  "
      data-depth="1">在Windows客户端中配置OpenVPN</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/ptr/"
      class="menu__title  "
      data-depth="1">关闭/开启 PTR</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/iso_l2tp/"
      class="menu__title  "
      data-depth="1">IOS 客户端如何连接L2TP-IPsecVPN？</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/vpc/faq/mac_openvpn_client/"
      class="menu__title  "
      data-depth="1">OpenVPN Mac 客户端使用方法</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  NAT 网关
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/nat_gateway/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/intro/nat_gateway/"
      class="menu__title  "
      data-depth="1">NAT 网关简介</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/intro/net_quota/"
      class="menu__title  "
      data-depth="1">绑定私有网络限制</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/manual/nat_user_guide/"
      class="menu__title  "
      data-depth="1">操作指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  最佳实践
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/best-practices/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/nat_gateway/best-practices/nat_and_vpc/"
      class="menu__title  "
      data-depth="1">NAT 网关配合 VPC 使用</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  公网 IP
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/eip/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/intro/introduction/"
      class="menu__title  "
      data-depth="1">什么是公网 IP</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/billing/price/"
      class="menu__title  "
      data-depth="1">计费指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quickstart/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/quickstart/ipv6_quick_start/"
      class="menu__title  "
      data-depth="1">搭建 IPv6 网络并开通公网访问</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  绑定 IPv4 公网 IP
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/ipv4/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv4/outband_ipv4/"
      class="menu__title  "
      data-depth="2">外部绑定公网 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv4/inband_ipv4/"
      class="menu__title  "
      data-depth="2">内部绑定公网 IP</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="2">
  绑定 IPv6 公网 IP
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/ipv6/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv6/outband_ipv6/"
      class="menu__title  "
      data-depth="2">外部绑定公网 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv6/inband_ipv6/"
      class="menu__title  "
      data-depth="2">内部绑定公网 IP</a>
  </li>
  
  
</ul>


  
  
  
  
  
  
  <li>
    <a href="/network/eip/manual/ipv6_auto_config/"
      class="menu__title  "
      data-depth="1">开启云服务器 IPv6 自动化配置</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/eip/faq/high_ping/"
      class="menu__title  "
      data-depth="1">公网IP网络延迟增大</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/faq/faq/"
      class="menu__title  "
      data-depth="1">连接问题</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/eip/faq/bill_faq/"
      class="menu__title  "
      data-depth="1">费用问题</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  负载均衡
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/loadbalancer/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/intro/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/introduction/"
      class="menu__title  "
      data-depth="1">什么是负载均衡</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/advantage/"
      class="menu__title  "
      data-depth="1">产品特性</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/senario/"
      class="menu__title  "
      data-depth="1">应用场景</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/intro/limit/"
      class="menu__title  "
      data-depth="1">产品限制</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  计费指南
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/billing/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/billing/price/"
      class="menu__title  "
      data-depth="1">计费指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  快速入门
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/quickstart/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/quickstart/quick_start/"
      class="menu__title  "
      data-depth="1">快速入门</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/manual/lb_user_guide/"
      class="menu__title  "
      data-depth="1">操作指南</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  最佳实践
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/best-practices/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/best-practices/lb_natgw/"
      class="menu__title  "
      data-depth="1">搭建跨越公网的负载均衡</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  常见问题
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/faq/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/after_end_miss/"
      class="menu__title  "
      data-depth="1">负载均衡后端不可用排查方法</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_502_503_504/"
      class="menu__title  more-space"
      data-depth="1">访问负载均衡器返回502/503/504是什么原因</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_bind_multi_cert/"
      class="menu__title  "
      data-depth="1">负载均衡器如何支持多证书</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/http2_enabled_does_not_take_effect/"
      class="menu__title  "
      data-depth="1">开启 HTTP2 不生效</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_check_session_hold/"
      class="menu__title  more-space"
      data-depth="1">如何检查负载均衡器会话保持是否生效</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_turn_on_http2/"
      class="menu__title  "
      data-depth="1">如何开启 HTTP2</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_session_hold/"
      class="menu__title  "
      data-depth="1">LB 会话保持</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/haproxy_log/"
      class="menu__title  "
      data-depth="1">rsyslog 日志分析</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_faq/"
      class="menu__title  "
      data-depth="1">常见问题</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_get_real_ip/"
      class="menu__title  "
      data-depth="1">获取来访者的真实 IP</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/lb_long_connection/"
      class="menu__title  "
      data-depth="1">开启长连接</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/http_check_failed/"
      class="menu__title  "
      data-depth="1">七层(HTTP/HTTPS)健康检查异常</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/tcp_check_fialed/"
      class="menu__title  "
      data-depth="1">四层（TCP/UDP）健康检查出现异常	</a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/network/loadbalancer/faq/connection_peer/"
      class="menu__title  more-space"
      data-depth="1">业务日志中出现“Connection reset by peer”的错误</a>
  </li>
  
  
</ul>


  
  
</ul>


      
      













<span class="menu__title--collapse  display-hide"
  data-depth="0">
  边界路由器
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list  "
  data-data=/border_router/ data-link=/network/vpc/manual/vpn/>
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  动态与公告
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/news/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/border_router/news/prodoct_news/"
      class="menu__title  "
      data-depth="1">产品动态</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse  "
  data-depth="1">
  产品简介
  <span
    class="menu__title--icon right">

  </span>
</span>
<ul class="menu__list "
  data-data=/intro/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/border_router/intro/border_router/"
      class="menu__title  "
      data-depth="1">边界路由器</a>
  </li>
  
  
</ul>


  
  
  
  













<span class="menu__title--collapse active "
  data-depth="1">
  操作指南
  <span
    class="menu__title--icon down">

  </span>
</span>
<ul class="menu__list active"
  data-data=/manual/ data-link=/network/vpc/manual/vpn/>
  
  
  
  
  
  <li>
    <a href="/network/border_router/manual/border_user_guide/"
      class="menu__title  "
      data-depth="1">操作指南</a>
  </li>
  
  
</ul>


  
  
</ul>


      
    </div>
  </nav>
</div>


<script src="/js/sidebar-tree.js"></script>


          </div>
          <div class="d-none col-md-2 d-xl-block d-md-block col-xl-2 td-toc d-print-none">
            


<h3 class="nav-title">本页目录</h3>


<nav id="TableOfContents">
  <ul>
    <li><a href="#操作场景">操作场景</a></li>
    <li><a href="#openvpn-服务">OpenVPN 服务</a>
      <ul>
        <li><a href="#启动-openvpn-服务">启动 OpenVPN 服务</a></li>
        <li><a href="#配置-openvpn-客户端">配置 OpenVPN 客户端</a></li>
        <li><a href="#mac">Mac</a></li>
      </ul>
    </li>
    <li><a href="#pptp-服务">PPTP 服务</a>
      <ul>
        <li><a href="#启动-pptp-服务">启动 PPTP 服务</a></li>
        <li><a href="#配置-pptp-客户端">配置 PPTP 客户端</a></li>
      </ul>
    </li>
    <li><a href="#l2tp-服务">L2TP 服务</a>
      <ul>
        <li><a href="#启用-l2tp-服务">启用 L2TP 服务</a></li>
        <li><a href="#配置-l2tp-客户端">配置 L2TP 客户端</a></li>
      </ul>
    </li>
    <li><a href="#使用限制">使用限制</a></li>
  </ul>
</nav>




          </div>
          <main class="col-12 col-md-7 col-xl-7" role="main">
            
  

            
            
            
<div class="td-content">
	<div class="td-sidebar-section-title content-index">
		<img class="is-40x40" src="/images/icons/book-open.svg">
		<h3 class="doc_vice_title">操作指南</h3>
		<a href="javascript:;" class="nav-trigger">&nbsp;<span aria-hidden="true"></span></a>
	</div>
	<div class="td-page-top">
		<h1>VPN 服务</h1>
		






<div class="td-page-meta page-meta-actions ml-2 pb-1 mb-0">







</div>



	</div>
	<div class="page-meta-lastmod text-muted ">
	更新时间 2020-02-28

</div>

	<input type="hidden" id="content_console" value="1">
	
	
	
	

	
	<p>VPN 服务支持 OpenVPN / PPTP / L2TP-IPsec 协议。</p>
<h2 id="操作场景">操作场景</h2>
<p>本篇指南旨在介绍如何远程拨入您在云平台上的私有网络。如果您希望将您自己的数据中心或办公、家庭网络与您的云上私有网络连接在一起，建议您使用 <a href="../tunnel/gre">GRE 隧道</a>形成公私兼顾的混合云（hybrid cloud）。</p>
<p>假设您当前位于办公网络，本地网络地址是 <code>192.168.1.0/24</code> ，下面我们的任务是将云上的两个私有网络网络与您的本地网络连接。</p>
<blockquote>
<p><strong>说明</strong>：</p>
<p>因为涉及到网络间互联，所以各个网络必须使用不同的网络地址， 否则地址就冲突了。如果存在地址冲突，您可以将私有网络与 VPC 网络断开、再重新连接至 VPC 网络， 在对话框中重新指定一个网络地址给私有网络。</p>
</blockquote>
<p><img src="../_images/hybrid_network_diagram.gif" alt=""></p>
<h2 id="openvpn-服务">OpenVPN 服务</h2>
<h3 id="启动-openvpn-服务">启动 OpenVPN 服务</h3>
<ol>
<li>
<p>登录管理控制台，选择<strong>产品与服务</strong> &gt; <strong>网络服务</strong> &gt; <strong>VPC 网络</strong>，进入 VPC 列表页面。</p>
</li>
<li>
<p>找到您的 VPC 网络，点击 VPC 网络名称，进入详情页。</p>
</li>
<li>
<p>切换至<strong>管理配置</strong>页签，然后在左侧点击 <strong>VPN 服务</strong>。</p>
</li>
<li>
<p>点击 <strong>Open VPN</strong> 后面的<strong>打开</strong>，弹出<strong>打开 OpenVPN 服务</strong>对话框。</p>
</li>
<li>
<p>配置 OpenVPN 参数，点击<strong>提交</strong>。</p>
<img src="../_images/webconsole_open_vpn.png" alt="VPN参数配置" style="zoom:50%;" />
<p>多数情况下，直接使用缺省配置即可，但建议您点开高级选项检查一下各项配置，尤其是 VPN 网络地址不能跟您的本地网络存在冲突。</p>
<p>OpenVPN 提供了多种验证方式，除默认的<strong>证书</strong>验证方式，还提供<strong>用户名/密码</strong>和 <strong>证书+用户名/密码</strong>验证方式。 若使用包含 “用户名/密码” 的验证方式，还需要添加对应的可授权账户列表。</p>
</li>
<li>
<p>点击页面上方的<strong>应用修改</strong>， 更新路由器的配置。</p>
</li>
<li>
<p>前往 VPC 网络使用防安全组规则中打开 OpenVPN 服务器的运行端口，如本例中，需要打开 UDP 下行 1194 端口。完成后点击<strong>应用更改</strong>。</p>
</li>
</ol>
<h3 id="配置-openvpn-客户端">配置 OpenVPN 客户端</h3>
<p>启用 OpenVPN 隧道服务后，将出现<strong>下载证书</strong>的按钮， 点击该按钮，即可得到文件名类似 <code>rtr-xxxxxxxx-certs.zip</code> 的 zip 包， 里面有配置 OpenVPN 客户端的必备证书，密钥文件和客户端配置文件样例：</p>
<ul>
<li>rtr-xxxxxxxx.crt: SSL 客户端证书</li>
<li>rtr-xxxxxxxx.key: SSL 客户端私钥</li>
<li>rtr-xxxxxxxx.takey: OpenVPN TLS Auth 密钥</li>
<li>yunify-ca.crt: CA 根证书</li>
</ul>
<blockquote>
<p><strong>说明</strong>：</p>
<p>以上四个文件是必需的配置文件，此外我们还在 zip 包中准备了不同操作系统下的配置文件样例，可作为参考。</p>
</blockquote>
<h4 id="windows">Windows</h4>
<ol>
<li>
<p>下载 OpenVPN Windows 安装包，并安装它。缺省情况下，OpenVPN 将被安装到 <code>C:\Program Files\OpenVPN</code> 目录中。（按照默认选项安装即可。如非必要，请勿自主勾选选项） 推荐使用OpenVPN官方客户端2.3.6和以上版本. 下载地址在： <a href="https://openvpn.net/get-open-vpn/">https://openvpn.net/get-open-vpn/</a> 安装程序包括服务器和客户端。安装时选择”OpenVPN GUI”模块即可安装客户端。</p>
</li>
<li>
<p>将前面 zip 包中的配置文件放入  <code>C:\Program Files\OpenVPN\config</code> 目录中。</p>
</li>
<li>
<p>将以下内容保存到 <code>C:\Program Files\OpenVPN\config</code> 目录中，文件名任意， 扩展名为 .ovpn ，比如可以叫做 <code>rtr-xxxxxxxx.ovpn</code></p>
<pre tabindex="0"><code>client
dev tun
proto &lt;udp&gt;
remote &lt;your-router-eip&gt; 1194
resolv-retry infinite
nobind
persist-key
persist-tun
ca yunify-ca.crt
cert &lt;rtr-xxxxxxxx.crt&gt;
key &lt;rtr-xxxxxxxx.key&gt;
tls-auth &lt;rtr-xxxxxxxx.takey&gt; 1
cipher AES-256-CBC
comp-lzo
mssfix 1400
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<p>请将以上文件中的<code>&lt;xxx&gt;</code> 部分替换成您的配置。如:
<code>remote &lt;your-router-eip&gt; 1194</code> 替换为 <code>remote 117.121.XXX.XXX 1194</code>。可参考 zip 包里带的 windows sample 配置样例。</p>
</blockquote>
<p>至此，您可以连接 VPN 了。</p>
</li>
</ol>
<h4 id="linux">Linux</h4>
<p>以 Ubuntu Linux 为例子来描述，其他的 Linux 分发版都是类似的做法。</p>
<ol>
<li>
<p>安装 OpenVPN。</p>
<pre tabindex="0"><code>$ sudo apt-get install openvpn
</code></pre></li>
<li>
<p>将前面 zip 包中的配置文件放入 <code>/etc/openvpn</code> 目录中。</p>
</li>
<li>
<p>将以下配置保存到 <code>/etc/openvpn</code> 目录中，文件名任意，扩展名为 <code>.conf</code>， 比如可以叫做 <code>rtr-xxxxxxxx.conf</code></p>
<pre tabindex="0"><code>client
dev tun
proto &lt;udp&gt;
remote &lt;your-router-eip&gt; 1194
resolv-retry infinite
nobind
user &lt;nobody&gt;
group &lt;nogroup&gt;
persist-key
persist-tun
ca yunify-ca.crt
cert &lt;rtr-xxxxxxxx.crt&gt;
key &lt;rtr-xxxxxxxx.key&gt;
tls-auth &lt;rtr-xxxxxxxx.takey&gt; 1
cipher AES-256-CBC
comp-lzo
mssfix 1400
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<ul>
<li>
<p>请将以上文件中的<code>&lt;xxx&gt;</code> 部分替换成您的配置。如:
<code>remote &lt;your-router-eip&gt; 1194</code> 替换为 <code>remote 117.121.XXX.XXX 1194</code>。可参考 zip 包里带的 windows sample 配置样例。</p>
</li>
<li>
<p>user / group 请分别查询您本地 Linux 系统的 <code>/etc/password</code> 和 <code>/etc/group</code> 文件。</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>连接 VPN。</p>
<pre tabindex="0"><code>$ sudo service openvpn start
</code></pre></li>
</ol>
<h3 id="mac">Mac</h3>
<ol>
<li>
<p>客户端以 <a href="https://code.google.com/p/tunnelblick/">Tunnelblick</a> 为例， 先下载安装 Tunnelblick 。</p>
</li>
<li>
<p>将前面 zip 包中的配置文件解压到同一目录中，其中 .ovpn 是 VPN 配置文件， 可根据需要做调整，样例如下</p>
<pre tabindex="0"><code>client
dev tun
proto &lt;udp&gt;
remote &lt;your-router-eip&gt; 1194
resolv-retry infinite
nobind
user nobody
group nogroup
persist-key
persist-tun
ca yunify-ca.crt
cert &lt;rtr-xxxxxxxx.crt&gt;
key &lt;rtr-xxxxxxxx.key&gt;
tls-auth &lt;rtr-xxxxxxxx.takey.key&gt; 1
cipher AES-256-CBC
comp-lzo
mssfix 1400
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<ul>
<li>
<p>user / group 可查询您本地系统的 <code>/etc/passwd</code> 和 <code>/etc/group</code> 文件。</p>
</li>
<li>
<p>请将以上文件中的<code>&lt;xxx&gt;</code> 部分替换成您的配置。如:
<code>remote &lt;your-router-eip&gt; 1194</code> 替换为 <code>remote 117.121.XXX.XXX 1194</code>。</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>在 Tunnelblick 面板中添加配置，或双击 .ovpn 文件便可将配置添加到 Tunnelblick，然后就可以连接了。</p>
</li>
</ol>
<h4 id="用户名密码验证">用户名/密码验证</h4>
<p>如果您的 OpenVPN 开启了 “用户名/密码” 登录方式，你需要在连接的时候提供用户名和密码输入，如果希望通过配置文件来解决， 您可以修改客户端的配置文件中的 “auth-user-pass password.txt” ，通过一个独立的文件，例如 “password.txt” 来保持用户名/密码信息。</p>
<blockquote>
<p><strong>说明</strong>：</p>
<p>如果是 Mac 系统，不需要 password.txt 文件，配置中 auth-user-pass 后面也不需要写文件名，只保留 “auth-user-pass” ，会在连接 VPN 时提示输入账号密码，并支持保存到 Mac 系统的 Keychain 中。</p>
</blockquote>
<p>样例如下：</p>
<pre tabindex="0"><code>client
dev tun
proto &lt;udp&gt;
remote &lt;your-router-eip&gt; 1194
resolv-retry infinite
nobind
user nobody
group nogroup
persist-key
persist-tun
ca yunify-ca.crt
cert &lt;rtr-xxxxxxxx.crt&gt;
key &lt;rtr-xxxxxxxx.key&gt;
tls-auth &lt;rtr-xxxxxxxx.takey.key&gt; 1
auth-user-pass password.txt
cipher AES-256-CBC
comp-lzo
mssfix 1400
</code></pre><p>password.txt 文件样例如下，用户名和密码分为两行存放。</p>
<pre tabindex="0"><code>&lt;user_name&gt;
&lt;password&gt;
</code></pre><h2 id="pptp-服务">PPTP 服务</h2>
<h3 id="启动-pptp-服务">启动 PPTP 服务</h3>
<ol>
<li>
<p>登录管理控制台，选择<strong>产品与服务</strong> &gt; <strong>网络服务</strong> &gt; <strong>VPC 网络</strong>，进入 VPC 列表页面。</p>
</li>
<li>
<p>找到您的 VPC 网络，点击 VPC 网络名称，进入详情页。</p>
</li>
<li>
<p>切换至<strong>管理配置</strong>页签，然后在左侧点击 <strong>VPN 服务</strong>。</p>
</li>
<li>
<p>点击 <strong>PPTP</strong> 后面的<strong>打开</strong>，弹出<strong>打开 PPTP 服务</strong>对话框。</p>
</li>
<li>
<p>配置 VPN 用户名和密码，点开高级选项检查一下各项配置，注意 VPN 网络地址不能跟您的本地网络存在冲突。</p>
<img src="../_images/webconsole_open_pptp.png" alt="打开PPTP服务" style="zoom:50%;" />
</li>
<li>
<p>点击<strong>提交</strong>，然后点击页面上方的<strong>应用修改</strong>， 以更新配置。</p>
</li>
<li>
<p>前往<strong>安全</strong> &gt; <strong>安全组</strong>，在 VPC 网络使用的安全组规则中，设置允许 PPTP 服务器运行端口通过， 即 TCP 下行 1723 端口; 同时还需要允许 GRE 协议。设置完成后，点击<strong>应用更改</strong> 。</p>
</li>
</ol>
<h3 id="配置-pptp-客户端">配置 PPTP 客户端</h3>
<h4 id="windows-xp">Windows XP</h4>
<ol>
<li>
<p>初次连接的用户，可以先通过以下步骤创建新的网络连接：</p>
<ol>
<li>
<p>单击<strong>开始</strong>，选择<strong>控制面板</strong>，单击<strong>网络和Internet连接</strong>。</p>
</li>
<li>
<p>选择<strong>创建一个到您的工作位置的网络连接</strong>。</p>
</li>
<li>
<p>选择<strong>虚拟专用网络连接</strong>，然后单击<strong>下一步</strong>。</p>
</li>
<li>
<p>输入公司名（自定义即可），然后单击<strong>下一步</strong>。</p>
</li>
<li>
<p>设置服务器地址为路由器的公网地址，单击<strong>下一步</strong>。</p>
</li>
<li>
<p>勾选<strong>在我的桌面上添加一个到此连接的快捷方式</strong>，然后单击 <strong>完成</strong>。</p>
</li>
</ol>
</li>
<li>
<p>若 VPN 网络连接已经创建，只需要在桌面上点击该网络连接，输入 VPN 连接的用户名和密码， 然后点击<strong>连接</strong>即可。</p>
</li>
<li>
<p>连接 VPN 之后，默认情况下本地默认网关会指向 VPN 服务器，即所有流量都会通过 VPN 服务器。 如果您不需要，可按如下步骤禁用：</p>
<ol>
<li>
<p>点击 VPN 连接中的<strong>属性</strong>，选择<strong>网络。</strong></p>
</li>
<li>
<p>选择<strong>TCP/IP</strong> 并点击<strong>属性</strong>。</p>
</li>
<li>
<p>在常规项中点击<strong>高级</strong>，去勾选<strong>在远程网络上使用默认网关</strong> ，点击<strong>确定</strong>。</p>
</li>
<li>
<p>断开并重新连接 VPN。</p>
</li>
</ol>
</li>
<li>
<p>禁用之后，你需要手动配置路由规则才能访问私有网络里的云服务器，具体操作如下：</p>
<ol>
<li>
<p>点击<strong>开始</strong>菜单，选择<strong>运行</strong>，输入<code>cmd</code>，并点击<strong>确定</strong>，进入命令行界面。</p>
</li>
<li>
<p>输入命令<code>ipconfig</code>，查看当前 VPN 的地址（10.255开头），例如是 “10.255.1.2” ，并假设你需要访问的私有网络地址是“192.168.1.0/24”。</p>
</li>
<li>
<p>添加路由规则 <code>route add 192.168.1.0 mask 255.255.255.0 10.255.1.2</code>。</p>
</li>
<li>
<p>测试是否可以正常访问 “192.168.1.0/24” ，例如 <code>ping 192.168.1.1</code>。</p>
</li>
</ol>
</li>
</ol>
<h4 id="windows-7">Windows 7</h4>
<ol>
<li>
<p>初次连接的用户，可以先通过以下步骤创建新的网络连接：</p>
<ol>
<li>
<p>单击<strong>开始</strong>，选择 <strong>控制面板</strong>，单 <strong>网络和Internet</strong>，单击<strong>网络和共享中心</strong>。</p>
</li>
<li>
<p>选择<strong>设置新的连接或网络</strong>，选择<strong>连接到工作区</strong>，单击<strong>下一步</strong>。</p>
</li>
<li>
<p>选择<strong>使用我的 Internet 连接(VPN)</strong>。</p>
</li>
<li>
<p>在 <strong>Internet 地址</strong> 处输入路由器的公网IP，<strong>目标名称</strong>可以自定义，单击<strong>下一步</strong>。</p>
</li>
<li>
<p>输入 VPN 连接的用户名和密码，点击<strong>连接</strong>即可完成。</p>
</li>
</ol>
</li>
<li>
<p>若 VPN 网络连接已经创建，只需点击桌面右下角的网络连接处，选择并点击相应的网络连接，在界面上输入 VPN 连接的用户名和密码， 然后点击<strong>连接</strong>即可。</p>
</li>
<li>
<p>连接 VPN 之后，默认情况下你本地默认网关会指向 VPN 服务器，即所有流量都会通过 VPN 服务器。 如果您不需要，可按如下步骤禁用：</p>
<ol>
<li>
<p>右键对应的 VPN 连接，选择<strong>属性</strong>。</p>
</li>
<li>
<p>选择<strong>网络</strong> 中的<strong>TCP/IPv4</strong>，然后点击<strong>属性</strong>。</p>
</li>
<li>
<p>在常规项中点击<strong>高级</strong>，将<strong>在远程网络上使用默认网关</strong> 前面的勾选去掉，点击<strong>确定</strong>。</p>
</li>
<li>
<p>断开并重新连接 VPN。</p>
</li>
</ol>
</li>
<li>
<p>禁用之后，你需要手动配置路由规则才能访问私有网络里的云服务器，具体操作是：</p>
<ol>
<li>
<p>点击<strong>开始</strong>菜单，找到 <strong>所有程序</strong> &gt; <strong>附件</strong> &gt; <strong>命令提示符</strong>，右键 <strong>以管理员身份运行</strong>，进入命令行界面。</p>
</li>
<li>
<p>输入命令<code>ipconfig</code>，查看当前 VPN 的地址（10.255开头），例如是10.255.1.2；并假设你需要访问的私有网络地址是192.168.1.0/24。</p>
</li>
<li>
<p>添加路由规则 <code>route add 192.168.1.0 mask 255.255.255.0 10.255.1.2</code>。</p>
</li>
<li>
<p>测试是否可以正常访问 “192.168.1.0/24 ，例如 <code>ping 192.168.1.1</code>。</p>
</li>
</ol>
</li>
</ol>
<h4 id="linux-1">Linux</h4>
<p>以 Ubuntu Linux 为例子来描述，其他的 Linux 分发版都是类似的做法。</p>
<ol>
<li>
<p>安装 PPTP 客户端：</p>
<pre tabindex="0"><code>$ sudo apt-get install pptp-linux
</code></pre></li>
<li>
<p>修改 /etc/ppp/chap-secrets 文件，配置验证所需的用户名和密码，字符串之间用 “\t” 分隔：</p>
<pre tabindex="0"><code>&lt;user_name&gt;   pptpd   &lt;password&gt;        *
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<p>请将以上文件中的 <code>&lt;xxx&gt;</code> 替换成您的配置。如:
<code>&lt;user_name&gt;   pptpd   &lt;password&gt;   *</code> 替换为 <code>guest   pptpd   passw0rd   *</code>。</p>
</blockquote>
</li>
<li>
<p>新建 <code>/etc/ppp/peers/&lt;tunnel&gt;</code> 文件，<tunnel> 是由你定义的一个隧道名称， 例如我们可以叫做 vpn，即这个文件为 <code>/etc/ppp/peers/vpn</code>：</p>
<pre tabindex="0"><code>pty &#34;pptp &lt;vpn_server_ip&gt; --nolaunchpppd --nobuffer --loglevel 0&#34;
name &lt;user_name&gt;
remotename pptpd
require-mppe-128
file /etc/ppp/options.pptp
ipparam &lt;tunnel&gt;
</code></pre><blockquote>
<p><strong>说明</strong>：
请将以上文件中的 <code>&lt;xxx&gt;</code> 部分替换成您的配置。释义如下：</p>
<ul>
<li><code>&lt;vpn_server_ip&gt;</code> ：路由器的公网IP；</li>
<li><code>&lt;user_name&gt;</code> ： VPN 连接的用户名；</li>
<li><code>&lt;tunnel&gt;</code> ：您定义的隧道名称，在本例中是 <code>vpn</code>。</li>
</ul>
</blockquote>
</li>
<li>
<p>启动 VPN 客户端。</p>
<pre tabindex="0"><code>$ pon &lt;tunnel&gt; persist
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<p>请将以上命令行中的<code>&lt;tunnel&gt;</code> 替换成你定义的隧道名称，在本例中是 vpn。</p>
</blockquote>
</li>
<li>
<p>配置路由规则。</p>
<ul>
<li>
<p>如果您希望通过 VPN 来访问路由器内部私有网络里的机器，你还需要手动配置路由规则， 假设你需要访问的私有网络的网络地址为 192.168.10.0/24，相应的路由配置为：</p>
<pre tabindex="0"><code>$ ip route add 192.168.10.0/24 dev ppp0
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<p>命令中的 ppp0 为客户端连接的设备名，如果你只有一个 VPN 客户端正在运行，那默认设备一般都是 ppp0，
如果不是，你可以通过 ifconfig 命令来进行查看。</p>
</blockquote>
</li>
<li>
<p>如果您希望在每次启动客户端之后能自动配置路由规则，则你可以将你需要的指令写成脚本，放置在 /etc/ppp/ip-up.d/ 下面。 例如，可以创建脚本文件 /etc/ppp/ip-up.d/add-route，内容为:</p>
<pre tabindex="0"><code>#!/bin/sh
ip route add 192.168.10.0/24 dev $1
</code></pre></li>
</ul>
</li>
<li>
<p>关闭 VPN 客户端。如果你想断开 VPN 连接，执行如下命令。</p>
<pre tabindex="0"><code>$ poff &lt;tunnel&gt;
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<p>请将以上命令行中的 <code>&lt;tunnel&gt;</code> 替换成你定义的隧道名称，在本例中是 vpn。</p>
</blockquote>
</li>
</ol>
<h2 id="l2tp-服务">L2TP 服务</h2>
<blockquote>
<p><strong>说明</strong>：</p>
<p>由于苹果的系统 Mac OS 已不再支持 PPTP 隧道服务和客户端等配置项，若您使用的设备系统是 Mac OS，建议您参考本节内容，使用 L2TP 的方式使用 VPN 服务 。</p>
</blockquote>
<h3 id="启用-l2tp-服务">启用 L2TP 服务</h3>
<ol>
<li>
<p>登录管理控制台，选择<strong>产品与服务</strong> &gt; <strong>网络服务</strong> &gt; <strong>VPC 网络</strong>，进入 VPC 列表页面。</p>
</li>
<li>
<p>找到您的 VPC 网络，点击 VPC 网络名称，进入详情页。</p>
</li>
<li>
<p>切换至<strong>管理配置</strong>页签，然后在左侧点击 <strong>VPN 服务</strong>。</p>
</li>
<li>
<p>点击 <strong>L2TP</strong> 后面的<strong>打开</strong>，弹出<strong>打开 L2TP 服务</strong>对话框。</p>
</li>
<li>
<p>配置 VPN 用户名、密码、PSK，点击高级选项检查一下各项配置，注意 VPN 网络地址不能跟您的本地网络存在冲突。</p>
<img src="../_images/webconsole_open_l2tp.png" alt="打开L2TP服务" style="zoom:50%;" />
</li>
<li>
<p>点击<strong>提交</strong>，然后点击页面上方的<strong>应用修改</strong>， 以更新配置。</p>
</li>
<li>
<p>前往<strong>安全</strong> &gt; <strong>安全组</strong>，在 VPC 网络使用的安全组规则中，设置允许 L2TP 服务运行端口通过，完成后，点击<strong>应用修改</strong>。</p>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>如果您使用的是 L2TP-IPsec 连接方式（iPhone 默认名字为 L2TP），请放行 UDP 下行 500 和 4500 端口以及 ESP 协议。</p>
</li>
<li>
<p>如果您使用的是 L2TP 连接方式，请放行 UDP 下行 1701 端口。</p>
</li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="配置-l2tp-客户端">配置 L2TP 客户端</h3>
<h4 id="linux-2">Linux</h4>
<p>以 Ubuntu Linux 为例子来描述，其他的 Linux 分发版都是类似的做法。 安装此客户端分为L2TP、IPsec两个部分。</p>
<h5 id="ipsec部分">IPsec部分</h5>
<ol>
<li>
<p>安装依赖包。</p>
<pre tabindex="0"><code>$ sudo apt-get install openswan
</code></pre></li>
<li>
<p>修改 <code>/etc/ipsec.conf</code> 配置。</p>
<pre tabindex="0"><code>version 2.0
config setup
    protostack=netkey
    nat_traversal=yes
    keep_alive=60
    virtual_private=
    oe=off

conn %default
    rekey=yes
    authby=secret
    auto=start
    type=tunnel
    keyexchange=ike
    phase2=esp
    pfs=yes
    dpddelay=15
    dpdtimeout=60
    dpdaction=restart

conn &lt;l2tp_name&gt;
    authby=secret
    type=transport
    pfs=no
    auto=start
    left=%defaultroute
    leftprotoport=17/1701
    right=&lt;l2tp_server_ip&gt;
    rightprotoport=17/1701
</code></pre><blockquote>
<p><strong>说明</strong>：
请将以上文件中的 <code>&lt;xxx&gt;</code> 连部分替换成您的配置，释义如下:</p>
<ul>
<li><code>&lt;l2tp_server_ip&gt;</code> ：路由器的公网IP；</li>
<li><code>&lt;l2tp_name&gt; </code>：IPsec连接名（请自行命名）。</li>
</ul>
</blockquote>
</li>
<li>
<p>修改 <code>/etc/ipsec.secrets</code> 配置。</p>
<pre tabindex="0"><code>%any &lt;l2tp_server_ip&gt;: PSK &#34;&lt;psk&gt;&#34;
</code></pre><blockquote>
<p><strong>说明</strong>：
请将以上文件中的 <code>&lt;xxx&gt;</code> 部分替换成您的配置，释义如下:</p>
<ul>
<li><code>&lt;l2tp_server_ip&gt;</code> ：路由器的公网IP；</li>
<li><code>&lt;psk&gt; </code>：预共享密钥。</li>
</ul>
</blockquote>
</li>
<li>
<p>重启服务。</p>
<pre tabindex="0"><code>$ sudo service ipsec restart
</code></pre><blockquote>
<p><strong>说明</strong>：</p>
<p>使用命令 <code>ipsec auto status</code> 检查连接是否正常建立。</p>
</blockquote>
</li>
</ol>
<h5 id="l2tp-部分">L2TP 部分</h5>
<ol>
<li>
<p>安装依赖包。</p>
<pre tabindex="0"><code>$ sudo apt-get install xl2tpd ppp
</code></pre></li>
<li>
<p>修改 <code>/etc/xl2tpd/xl2tpd.conf</code> 配置。</p>
<pre tabindex="0"><code>[lac &lt;lac_name&gt;]
lns = &lt;l2tp_server_ip&gt;
refuse chap = yes
refuse pap = yes
require authentication = yes
length bit = yes
pppoptfile = /etc/ppp/&lt;l2tp_name&gt;
</code></pre><blockquote>
<p><strong>说明</strong>：
请将以上文件中的 <code>&lt;xxx&gt;</code> 部分替换成您的配置，释义如下:</p>
<ul>
<li><code>&lt;lac_name&gt;</code> ：lac命名（请自行命名）；</li>
<li><code>&lt;l2tp_server_ip&gt;</code> ： 路由器的公网IP；</li>
<li><code>&lt;l2tp_name&gt;</code> ：ppp配置的文件名（请自行命名）。</li>
</ul>
</blockquote>
</li>
<li>
<p>新建 <code>/etc/ppp/&lt;l2tp_name&gt;</code> 配置文件。</p>
<pre tabindex="0"><code>+chap
lock
refuse-eap
require-chap
require-mschap
require-mschap-v2
noauth
noccp
nodefaultroute
proxyarp
name &#34;&lt;user_name&gt;&#34;
password &#34;&lt;password&gt;&#34;
</code></pre><blockquote>
<p><strong>说明</strong>：
请将以上文件中的 <code>&lt;xxx&gt;</code> 部分替换成您的配置。释义如下:</p>
<ul>
<li>
<p><code>&lt;user_name&gt;</code> ：用户名；</p>
</li>
<li>
<p><code>&lt;password&gt;</code> ：密码。</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>重启服务。</p>
<pre tabindex="0"><code>$ sudo service xl2tpd restart
</code></pre></li>
<li>
<p>建立连接，如果您想使用IPsec加密，请务必先完成IPsec部分的配置。</p>
<pre tabindex="0"><code>$ sudo echo &#34;c &lt;lac_name&gt;&#34; &gt; /var/run/xl2tpd/l2tp-control
</code></pre><blockquote>
<p><strong>说明</strong>：
关闭连接使用: <code>$ sudo echo “d &lt;lac_name&gt;” &gt; /var/run/xl2tpd/l2tp-control</code>。</p>
<p>请将以上命令中的 <code>&lt;lac_name&gt;</code> 替换成第二步的&lt;lac_name&gt;的命名。</p>
</blockquote>
</li>
<li>
<p>添加路由。</p>
<pre tabindex="0"><code>$ sudo ip route add &lt;ip_network&gt; dev &lt;link_name&gt;
</code></pre><blockquote>
<p><strong>说明</strong>：
请将以上命令中的 <code>&lt;xxx&gt;</code> 部分替换成您的配置。释义如下:</p>
<ul>
<li><code>&lt;ip_network&gt;</code> ：路由器下的私有网络地址段;</li>
<li><code>&lt;link_name&gt;</code> ：ppp连接的网卡接口名字，通常以ppp开头。</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="使用限制">使用限制</h2>
<table>
<thead>
<tr>
<th style="text-align:left">VPN 类型</th>
<th style="text-align:left">OpenVPN</th>
<th style="text-align:left">PPTP</th>
<th style="text-align:left">L2TP</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">单 VPC 可添加的 VPN 账户数量</td>
<td style="text-align:left">63</td>
<td style="text-align:left">254</td>
<td style="text-align:left">254</td>
</tr>
</tbody>
</table>

	
	
	<div class="page-meta-pagination border-top">
		
		<a href="/network/vpc/manual/30_fig_manage/" class="prev pl1" title="图形化操作 ">
			上一页: 图形化操作
		</a>
		

		
		<a href="/network/vpc/manual/route_table/" class="next pr1" title="使用路由表">
			下一页: 使用路由表
		</a>
		
	</div>
	<div class="page-meta-pagination_word">
		这篇文档解决了您的问题吗？
		<div class="doc_fix_click fix-background-like" data-flag='1'>
			<span>0</span>
		</div>
		<div class="doc_fix_click fix-background-unlike" data-flag='0'>
			<span>0</span>
		</div>
		<input type="hidden" id="doc_fix_flag" value="0">
	</div>
</div>
<script src="/js/content.js"></script>
<script src="/js/viewer.min.js"></script>
<link rel="stylesheet" href="/css/viewer.min.css">
<script>
	var viewer = new Viewer(document.querySelector('.td-content'), {
		url: 'src'
	})
</script>

          </main>
        </div>
      </div>
    </div>
         
    
<script src="/css/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
</script>






<script src="/js/main.min.7d5b92c4889cf0554b0ea5e2309b0b81b196aa7c9a235632938a25d9fc4d8a7c.js" integrity="sha256-fVuSxIic8FVLDqXiMJsLgbGWqnyaI1Yyk4ol2fxNinw=" crossorigin="anonymous"></script>



  </body>
</html>